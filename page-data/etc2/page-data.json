{"componentChunkName":"component---src-templates-blog-template-js","path":"/etc2/","result":{"data":{"cur":{"id":"08536e5b-97e7-5bfc-849d-8d23d2b86f2e","html":"<h2 id=\"intro-\" style=\"position:relative;\"><a href=\"#intro-\" aria-label=\"intro  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>intro 😃</h2>\n<blockquote>\n<p>새해를 맞이해서 지난 1년간 어떤 일을 했는가 돌아보다보니 성취한 것들에 대한 내용들만 적게 되더라고요. 그래서 오늘은 스스로가 어떤 성격이고, 왜 이런 성격을 가지게 되었는지 살펴보고자 합니다.</p>\n</blockquote>\n<h2 id=\"episode-1--뻔fun하다\" style=\"position:relative;\"><a href=\"#episode-1--%EB%BB%94fun%ED%95%98%EB%8B%A4\" aria-label=\"episode 1  뻔fun하다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>episode 1:  뻔(fun)하다.</strong></h2>\n<blockquote>\n<p>어릴 때부터 짱구처럼 오늘은 또 어떤 재밌는 일이 나를 기다릴까 기대하며 하루를 시작해요. 하루에도 여러번 피식하고 웃음이 나는 일이 있거든요. 그런 순간이 언제인지 그 타이밍이 오면 웃음을 놓치지 않고 누구보다 음미하면서 웃으려고 노력하는 성격이에요. 웃음 소리가 너무커서 가끔 주변 눈치를 보기도 하는데, 이런 순간들이 삶을 살아가게 하는 것 같아요.</p>\n</blockquote>\n<p>첫번째로 음악을 통해 많이 웃는 것 같아요. 요새 취미가 <strong>산책하면서 노래부르기인데, 노래를 따라 부르다보면 스트레스도 풀리고, 노래 가사에 알맞는 상황에서 딱 그 구절을 부르고 함께 있는 상대방의 반응을 살피면 너무 웃겨요.</strong> 그래서 많이 웃게 돼요.</p>\n<p>또 진지한 상황에서 위트있게 풀어가려는 노력도 많이 하는 편이에요. 문제를 너무 심각하게 바라보면 끝이 없거든요. 결론을 내려야하는데, 조금 더 나은 결론을 내기 위해서는 무거운 감정을 살짝 내려놓고 이성적으로 바라보는 노력이 필요하다고 생각해요. 그래서 분위기를 환기 시키는 용도로 농담을 즐기곤 합니다.</p>\n<p>이런 성격이 형성된 기저에는 웃음이 많은 사람들 속에서 자라며  웃음이 주는 긍정적인 경험들이 있어요. 이 글을 읽는 여러분 모두 자주 웃고 자주 행복을 느끼세요 ❤️</p>\n<br>\n<h2 id=\"episode-2-릴리즈release-하다\" style=\"position:relative;\"><a href=\"#episode-2-%EB%A6%B4%EB%A6%AC%EC%A6%88release-%ED%95%98%EB%8B%A4\" aria-label=\"episode 2 릴리즈release 하다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>episode 2: 릴리즈(release) 하다</strong></h2>\n<blockquote>\n<p>스트레스를 받으면 운동을 하거나 책을 읽어요. 내 몸에 움직임이나, 글에 집중하다보면 잡생각이 사라지고,  스트레스 받은 원인에 대해서 감정을 배제하고 생각할 수 있거든요.  해결 방법에 대한 인사이트를 책을 통해서 얻기도 하고, 왜 스트레스를 받고 있는지 스스로 질문해보며 기분이 전환됨을 느낄 때 좋더라고요!</p>\n</blockquote>\n<p>그런 맥락에서 글쓰기도 좋아해요. 글쓸 때는 엄청나게 집중해야해요. 그래서 잡생각이 안나서 좋아요. 글을 쓰기 시작할 때 막막함이 글을 다 쓴 뒤 성취감으로 다가오는 점도 좋아요. 제 글이 누군가에게 닿아 위로가 되고, 도움이 될 때 뿌듯하더라고요. 또 사진보다 그때의 내 감정과 생각들을 더 생생히 담아둘 수 있다는 점이 매력적으로 느껴져요.</p>\n<p>요새 <a href=\"sudal.site\">블로그</a>를 시작했어요. 제가 책을 읽고 느끼는 감정이나, 최근에 내 생각, 개발을 하며 알게된 인사이트들을 생생히 담고 싶어요.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEqklEQVQ4ywXBWVMTBwAA4H3sP+hDH50R7VSulBzkvqQCrT1olalV8UIiNkCuJZs9cuwmgRxAgghUROvYOlAdtQRCrt1NNnfCGTBBMILYVuv0L/T7AM+tNu/UV8PTrY5JpXfitN1/EhsR4n45Pi5Fx4SwTzjo5cJjfGhUcBmrPaM90qk73tFfcwmtdd5TAPjoSdx3yjwiQ1wSi0cCewQGBwca4iNOEeRuRnx8yCsYdAtgHxed5OJ3mom7Muc9OTGjsM3IAC3ONeISyCIz2sQmVIJg8ptwkwquu4k0GggONCxAPTJkRAK5eeg4H7vFRycE2G2e877QOSsCdBa+0SKBLUo9IkBR5SAqh20igpBhhBS0CkxDYpNbZHSJzH4x4uNaJ3jYeBPi42K32eZJFqA3SkFYYgAVapB3deDEmLd1+5manri2Oo/cmTijglhGh9jgFOncn5v8HMQnNfv59kmxc0ZimxADl/vqb2i53Wr2j9eOn+r8xGb6pkz9Gp+9WP3zyh9Tbde0DbBdrLM191lYoJNt9PCwcbH1tsQ5IxqalQKtFz7u6D7SrecbsHO/zU3FAg9WQg+feVSJqbPDWNMV9THQwgcJgckh11sFg07h4Ahf66ozuFmonwWgzq4Hv/uDoSfJZCKdSq3ST6mHzuW56dD83adzIya0vU/PMWIKjFCCFrmGaB6wN5jcHNjDh5wcoFjIpzMZko6trqS3y6Xy7l7pxYvVtWI6Sa6v5HIZ2juuUuk5GkQK4koYl5psItuoDB8XoV4BkExSVDxCMond6t77D+9evnpV3qm8+/DfxlqeIoPZdLy0Xpi6Z+3Vsc0WGWRXGnDOoIMFOliQiwVQdJSkIvn1jf2//t7a2dmqVF7t77//8O/Bm4MEucQkoplUbD2XdczCX462aAz1KiMHtDcM2FhaKwug6XA4vBShyPLrw/LrN5XXB4dvDw7fHlbf/rNWKmWzia3dyuF+1fLkzkdga8f13g61S2O7Cg3Vg3YOEIuFlpaD4fBSNBIsrBRK5cr2y5cv9g4yqxt71d1qdYekw4Hg4uPFua8vXOKd+qntbM95VacBq9PjLCASC8fIZSYRoelIKBRYCDxfCgbiSWa9tFne2c4wkflH9/PZ2ONH01yhWCgVtbS3/9DZ1mfgITgfSDJkPkvHE2SMjDIMHY+TS8uLkXAgGossPH+cogMr+URlKz82Qhz9rOZobb1I+UXr6fbu/lqE4AHpJMkwZDxBMQxNUrFwNJLJJNIpKhxZTCeiMZIKLc67PDq1pl3RcqKRf0wgEX/XIe4H2RAqAuLxaDpNM0k6EovScapYSGczcZKKrhZTodAT2Hq1s+vTLlWNFuT29ArO9zSqfmYb9HLEqsCdSiCTIsOhwHJwIZOOMwxFx8lsLrm5ni/ksjDWcbbn+KWBhm5tXb+xyUCwNVDzTT1r0NqsJ9i4Rwikk1EquphiotkUSZOhYp7ZWCsWijkL3nOxq/GGVqpBxdfBOr1ZYLIJEZvMaBEbCWGviTUAc4BMOlHMpzbXctubhWyWWQg8/2XaowW//f5cTa9a2q+RgJhEZxaah1tMhHgAYUH4CWJYYXG1gbjkf/wcjj9hsnyoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"피크닉.png\"\n        title=\"피크닉.png\"\n        src=\"/static/60670b969a3f127108cbb9dec9cb2840/37523/p.png\"\n        srcset=\"/static/60670b969a3f127108cbb9dec9cb2840/e9ff0/p.png 180w,\n/static/60670b969a3f127108cbb9dec9cb2840/f21e7/p.png 360w,\n/static/60670b969a3f127108cbb9dec9cb2840/37523/p.png 720w,\n/static/60670b969a3f127108cbb9dec9cb2840/302a4/p.png 1080w,\n/static/60670b969a3f127108cbb9dec9cb2840/07a9c/p.png 1440w,\n/static/60670b969a3f127108cbb9dec9cb2840/669cd/p.png 3024w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"episode-3-런learn-하다\" style=\"position:relative;\"><a href=\"#episode-3-%EB%9F%B0learn-%ED%95%98%EB%8B%A4\" aria-label=\"episode 3 런learn 하다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>episode 3: 런(learn) 하다.</strong></h2>\n<blockquote>\n<p>“남들이 보는 나는 어떨까?” 라고 고민하던 시기가 있었어요. 그 때 제가 가장 소중하게 생각하는 분께서 <strong>가치판단의 무게중심을 외부에 두지 말고, 내부에 두면 어떤 상황이든 흔들리지 않는 편안함을 가질 수 있다</strong>고 조언해주셨어요. (시몬스 침대 아님)</p>\n</blockquote>\n<p>그래서 저는 어제보다 나은 나와 경쟁하기로 했어요. 최근에는 데일리 기상 스터디를 열어서 하루를 조금 더 체계적으로 살기 위해 노력하고 있어요. 또 두개의 책 스터디에 가입해서 매주 책 읽기를 강제하고 있어요. 의지보다 더 강력한건 그렇게 할 수 밖에 없는 환경을 조성하는 것임을 우아한테크코스를 수료하며 느꼈거든요. 거기서 알게 된 사람들과 함께 더 나은 삶을 도모하며 보내는 하루 하루가 재밌어요.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 104.44444444444443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAFd0lEQVQ4yy3RWVNbhwGG4fObeuFJG8d1aRynScAOdoAQFlmEVZI5FpIQQtvRkdC+S0gCAWazjITZiglekMFKWI3NZpZxbCeeJNOZXvaqV29nmF489+83n1CYv8vSswKP1ufJz4+SnUwzlh9kNJ9k7ukKT178wdLmOxbX3/Jw4y1LG+94svsbC8U94qkRUtlxIqlh4ulhzA4vgivlJjwWJVXI4E37sIRkAsNh/MN+Rh8uMbf5K/nSKfm1EwrPT5kpnbH84gP5xzsksuMMj+YIeV3EQj5i0QTC+FyW6EiIwKAPd1ymx9WD2WdFSjoYWVzkwcav5NZOyBWPuf/smKnVY2bW3zJV3McVyVCrbEF22pCcNnRWF4Kc9JFdGCFXKhDL9SMPBAiOhfEMucnOzzOz8Qv51WMK/ze9dsLcxlumVl5ytaKSiupvSSTD2B1mzE4PQp/fTHg4QHwyhhS2Y3B1Y4/KSAk7Aw+mmV1/T371NVPFo3P5Z4csbr9HZ/XwUdkVRMlDMOzF73PgCcUQcg+HSY2HSY4F8SZkulxGEpk+ClNhUtMF5jffU1g9Ir9ycO7+030W1t8QyN6nVqNDY3MTCnsx9eqQPH4Ed9LDyMIgM8/vMZLvJ5T1M1ZIMpoLcXdmmqe7H1j86YSF1UNmnx1Q3Dig9OKUXneEVp2JW20dRANOIj6JbCaFEIo7GJwIMngvjOQz0WUTsQXNWII9DORzLO+8Y750xMLqPqX1l/z3t30+vDlG1eviYlkZX1WUk04G8TlNRJMxhJmlLDMLKbKTIVxhGwaHjr6wBUfUxOhcnrXDP1jePKb44w4/H72Cf7/mP7+fMTQ4wBc3btIpOYnFg8h2HYlkBCGYcjGx0E92PoHWLlKvUWAN9SLHzaTHs8yvbDG7vMZyscTTx4/YLP7Au1c/sjg7hSi7MQWjJBJBPHI38WQIIRDvxRkyYPNpUeubUKjrEG2d6B1anD4HwVg/qaFRHv2wTHYgTTqTZjo3idFqRZRdtBm6zx922rrwB5wI0bQFo11Fl6Udjb6JutZqrB4t1rCRqbkJ9l6/YePlAZtb2+zubLO9s8PZ2RkjE5OUV33Dx5c+ximb8MoGBhIehOCghD1iwJk2o7xdz98rP6XTpkJOWsg/GObo6JjS5jY/be+wsfOC3b19Xu7tMXR3CHWXiN5hJRzxIJs7kWQTQjhjRvLdwRU1nJdqelrQOUQMfSJjU1n29o9Y395ha/cVu3sHHJ+e4g14+Oqbr3ElIjj7YwSjHiSThv6QhJDMWOixdWCwttOpV9KsrsHpFzF5RYbuZdg/PDqfWSo+YmX5n6w/L/L9rW9R3VHhyySwBz14vXZshjbcsgHB4lDTFzcixXpQdNRwufwTRHMr9mg3w/cyHB4c8vjhfUbDRrzdStxWkSZFFQ3KWsyyBZW2A5vLSiQoEQvYEJo7anDHu7H6tWi6b6EUa2nRK+lyaPAlPAT6s4yNJtGLTSjqbyAb22moq+TPn1xAdbsVh89Jh1aFQlHFQFRCCMUMmCzN6HqauC3WYzQp8Ue0qHuUmGQD6f442YEo6vYGFHWVeMwaGr+7zuXP/obqThvphER7Rx0XL/2J7jsKBJtXpMveil5WoepqoFpZgdijoM3QiNOl5bQ0xVwugaq1jobvrhO03aax9hqVN7+gMB5iYsiFydjM5bIL2I0tCN931mPyajC6VIgmJXXqaqqV16lpuUZ/WMu/tiY5eZJC21FHTVU5Poua5sabXLl6iSblTcorPuWzf1zi6ucX6WyvQdAZbmE0KtDr61GrqzHZW7BITXxdd4Wgt5Ot2QRbeT92fTPVVRW4jK00N1Zy8a8XUCpuUFPzJV9WlHHl6l9obrzG/wC1B2IC8V9LuAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"좋아하는 글귀\"\n        title=\"좋아하는 글귀\"\n        src=\"/static/586f34c3b1e670869d5f6c81f2cba73f/37523/%EA%B8%80%EA%B7%80.png\"\n        srcset=\"/static/586f34c3b1e670869d5f6c81f2cba73f/e9ff0/%EA%B8%80%EA%B7%80.png 180w,\n/static/586f34c3b1e670869d5f6c81f2cba73f/f21e7/%EA%B8%80%EA%B7%80.png 360w,\n/static/586f34c3b1e670869d5f6c81f2cba73f/37523/%EA%B8%80%EA%B7%80.png 720w,\n/static/586f34c3b1e670869d5f6c81f2cba73f/84cc5/%EA%B8%80%EA%B7%80.png 898w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"the-present-\" style=\"position:relative;\"><a href=\"#the-present-\" aria-label=\"the present  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>the present :</h2>\n<p>스스로를 돌보는 일이 중요한지 알면서도 잘 못하는 일인 것 같아요. 글을 적다보니 스스로를 잘 모르고 있었구나 싶었어요.  새해에는 이렇게 나에 대해서 자주 궁금해하고, 알아가려고 노력하는 시간을 가져야겠다고 느꼇습니다. 새해에는 더 즐겁게 소통하는 법을 배우고 나누기 위해 글또라는 대외활동을 시작하려고 합니다. ✨ 앞으로 더욱더, 자주 제 생각을 나누도록 노력할게요. 오늘도 행복하세요!</p>","excerpt":"intro 😃 새해를 맞이해서 지난 1년간 어떤 일을 했는가 돌아보다보니 성취한 것들에 대한 내용들만 적게 되더라고요. 그래서 오늘은 스스로가 어떤 성격이고, 왜 이런 성격을 가지게 되었는지 살펴보고자 합니다. episode 1:  뻔(fun)하다. 어릴 때부터 짱구처럼 오늘은 또 어떤 재밌는 일이 나를 기다릴까 기대하며 하루를 시작해요. 하루에도 여러번 피식하고 웃음이 나는 일이 있거든요. 그런 순간이 언제인지 그 타이밍이 오면 웃음을 놓치지 않고 누구보다 음미하면서 웃으려고 노력하는 성격이에요. 웃음 소리가 너무커서 가끔 주변 눈치를 보기도 하는데, 이런 순간들이 삶을 살아가게 하는 것 같아요. 첫번째로 음악을 통해 많이 웃는 것 같아요. 요새 취미가 산책하면서 노래부르기인데, 노래를 따라 부르다보면 스트레스도 풀리고, 노래 가사에 알맞는 상황에서 딱 그 구절을 부르고 함께 있는 상대방의 반응을 살피면 너무 웃겨요. 그래서 많이 웃게 돼요. 또 진지한 상황에서 위트있게 풀어가려…","frontmatter":{"date":"January 05, 2023","title":"about me.","categories":"etc","author":"수달","emoji":"🙂"},"fields":{"slug":"/etc2/"}},"next":{"id":"00cc2abd-74a9-5046-ba95-58123e3c41d1","html":"<h2 id=\"왜-namedlock-을-사용해야하는가-\" style=\"position:relative;\"><a href=\"#%EC%99%9C-namedlock-%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC%ED%95%98%EB%8A%94%EA%B0%80-\" aria-label=\"왜 namedlock 을 사용해야하는가  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 NamedLock 을 사용해야하는가 ?</h2>\n<p>보통 분산락이라는 키워드로 검색을 해보면 레디스가 많이 나오는데요, MySQL lock 을 사용해서도 분산락을 구현할 수 있어요! 레디스를 사용하려면 인프라 구축 비용도 들고, 비지니스 로직 또한 별도로 구축해주어야하기 때문에 바용이 꽤 크다고 볼 수 있어요. 만약 지금 MySQL 을 사용하고 있다면, <strong>이름으로 Lock 을 지정</strong>해줄 수 있는 네임드 락을 이용해서 분산락을 구현하면 <strong>어플리케이션 단에서 제어가 가능</strong>하고, <strong>인프라 구축 및 유지보수 비용도 줄일 수 있습니다!</strong></p>\n<h2 id=\"namedlock-사용-방법\" style=\"position:relative;\"><a href=\"#namedlock-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95\" aria-label=\"namedlock 사용 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NamedLock 사용 방법</h2>\n<p>직접 MySQL 키워드를 사용하여 LOCK 을 획득하면 됩니다.  저희는 네이티브 쿼리를 사용해서 획득하고 싶은 락에 대한 이름을 매개변수로 넘겨주어 락을 구현해보겠습니다.</p>\n<h2 id=\"step-1-락-획득하기\" style=\"position:relative;\"><a href=\"#step-1-%EB%9D%BD-%ED%9A%8D%EB%93%9D%ED%95%98%EA%B8%B0\" aria-label=\"step 1 락 획득하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 1) 락 획득하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">LockRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Stock</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"select get_lock(:key, 3000)\"</span><span class=\"token punctuation\">,</span> nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">getLock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 이부분!</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><strong>GET_LOCK(str,timeout)</strong>\n<ul>\n<li>입력받은 이름(str) 으로 timeout 초 동안 잠금 획득을 시도합니다. timeout 에 음수를 입력하면 잠금을 획득할 때까지 무한대로 대기하게 됩니다.</li>\n<li>한 session에서 잠금을 유지하고 있는동안에는 다른 session에서 <strong>동일한 이름의 잠금을 획득 할 수 없습니다.</strong></li>\n<li><code class=\"language-text\">GET_LOCK() 을 이용하여 획득한 잠금은 Transaction 이 commit 되거나 rollback 되어도 해제되지 않습니다.</code></li>\n<li><strong>GET_LOCK() 의 결과값은 1(성공), 0(실패), null(에러발생) 을 반환</strong>합니다.</li>\n<li><strong>MySQL 5.7 이상 버전과 5.7 미만 버전의 차이</strong></li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>5.7 미만</th>\n<th>5.7 이상</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>동시에 하나의 잠금만 획득 가능</td>\n<td>동시에 여러개 잠금 획득 가능</td>\n</tr>\n<tr>\n<td>잠금 이름 글자수 무제한</td>\n<td>잠금 이름 글자수 60자로 제한</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>MySQL 5.7 이전 버전에서 GET_LOCK() 을 이용하여 동시에 여러개의 잠금을 획득하게 되면, 이전에 획득했던 잠금이 해제되게 됩니다.</li>\n<li>동시에 잠금을 획득하기위해 대기할 때 대기 순서는 보장되지 않습니다.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"step-2-락-반납하기\" style=\"position:relative;\"><a href=\"#step-2-%EB%9D%BD-%EB%B0%98%EB%82%A9%ED%95%98%EA%B8%B0\" aria-label=\"step 2 락 반납하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>STEP 2) 락 반납하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">LockRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Stock</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"select get_lock(:key, 3000)\"</span><span class=\"token punctuation\">,</span> nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">getLock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n\n\t<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"select release_lock(:key)\"</span><span class=\"token punctuation\">,</span> nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">releaseLock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 이부분!</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li><strong>RELEASE_LOCK(str)</strong>\n<ul>\n<li>입력받은 이름(str) 의 <strong>잠금을 해제</strong>합니다.</li>\n<li>RELEASE_LOCK() 의 <strong>결과값은 1(잠금해제 성공), 0(현재 스레드에서 획득한 잠금이 아님) ,null(잠금 없음) 을 반환합니다.</strong></li>\n</ul>\n</li>\n</ul>\n<p>해당 락은 <code class=\"language-text\">스레드가 종료된다고해서 자동으로 락이 반납되는게 아니기 때문에</code> 꼭꼭꼭 락을 반납해줘야합니다.</p>\n<h2 id=\"etc-락-관련된-다른-함수들\" style=\"position:relative;\"><a href=\"#etc-%EB%9D%BD-%EA%B4%80%EB%A0%A8%EB%90%9C-%EB%8B%A4%EB%A5%B8-%ED%95%A8%EC%88%98%EB%93%A4\" aria-label=\"etc 락 관련된 다른 함수들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ETC) 락 관련된 다른 함수들</h2>\n<p>그 외에도 락이 있는지 확인하거나 사용중인지 확인하는 기타 함수들이 있습니다.</p>\n<ul>\n<li><strong>RELEASE_ALL_LOCKS()</strong>\n<ul>\n<li>현재 세션에서 유지되고 있는 모든 잠금을 해제하고 해제한 잠금 갯수를 반환합니다.</li>\n</ul>\n</li>\n<li><strong>IS_FREE_LOCK(str)</strong>\n<ul>\n<li>입력한 이름(str)에 해당하는 잠금이 획득 가능한지 확인합니다.</li>\n<li>결과 값으로 1, 0, null 을 반환합니다.</li>\n<li>1 : 입력한 이름의 잠금이 없을때</li>\n<li>0 : 입력한 이름의 잠금이 있을때</li>\n<li>null : 에러발생시(ex : 잘못된 인자)</li>\n</ul>\n</li>\n<li><strong>IS_USED_LOCK(str)</strong>\n<ul>\n<li>입력한 이름(str)의 잠금이 사용중인지 확인합니다.</li>\n<li>입력받은 이름의 잠금이 존재하면 connection id 를 반환하고, 없으면 null 을 반환합니다.</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"프로젝트-구축-방법\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%B6%95-%EB%B0%A9%EB%B2%95\" aria-label=\"프로젝트 구축 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프로젝트 구축 방법</h2>\n<p><a href=\"https://start.spring.io/\">https://start.spring.io/</a> 에서 아래와 같이 설정을 한 후, 생성을 눌러 프로젝트 파일을 만듭니다! 이번 학습에서는 스프링과 JPA 를 사용할 예정입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuUlEQVQoz3VTSXLbMBDkL2JZXEFsJABSBDeRlu0csrwg/39Kp2YUpmxVcugCMBj09CxI6qbFz18/oKKGm3q8vn/DMF9xyiqci5rxnAvG4/mj7bAnea3h5x65lqiMgXE9hGrxlJZ/nY4HFITOaSFxLj8THfskExKq9ciEwjmv8eVcQlgLfxlR1AalNEhLyaBg0nqcshJP6T2DPi5Y9lcM8wbteiS5UAhjhHIOQrcohEEuJSpteF9Ki6xSTH59+Yr9+w3dNkDbHroNsP6CtoswbQevLZK80pjWG+Ky82NGbSGNR2Us0lpwqrnQ6OKMy7RgfJvh+ojaOLYTKKgSCgml0oQBcdl4JZXkQMRFTc6KUyOF8/WGbljg1gBqpjSOSVUTIFQDW2skR7Hp8jKtCMME10W4fmSEywzreyYcpg3dMsJvAWmhuDFHfQmBUiZCkmtdzwopmm47SHuPTmulGvahpmgXoIPn88eRIZSVvBMK3TBJnHes+xvGdWeVFOAoOPnRKFF3CTwq+eeZPNEcPhcCynr4IXK3x/WFycmm/6glpY9q/ofkGMx7apZrlSnBK9WWVB2/5l+/45HwN69ePGuCUu+/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"프로젝트.png\"\n        title=\"프로젝트.png\"\n        src=\"/static/ef871029f96899f8aa02a3366820267f/37523/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8.png\"\n        srcset=\"/static/ef871029f96899f8aa02a3366820267f/e9ff0/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8.png 180w,\n/static/ef871029f96899f8aa02a3366820267f/f21e7/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8.png 360w,\n/static/ef871029f96899f8aa02a3366820267f/37523/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8.png 720w,\n/static/ef871029f96899f8aa02a3366820267f/302a4/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8.png 1080w,\n/static/ef871029f96899f8aa02a3366820267f/07a9c/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8.png 1440w,\n/static/ef871029f96899f8aa02a3366820267f/d8ced/%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8.png 2652w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"1️⃣사용할-도메인재고--구현\" style=\"position:relative;\"><a href=\"#1%EF%B8%8F%E2%83%A3%EC%82%AC%EC%9A%A9%ED%95%A0-%EB%8F%84%EB%A9%94%EC%9D%B8%EC%9E%AC%EA%B3%A0--%EA%B5%AC%ED%98%84\" aria-label=\"1️⃣사용할 도메인재고  구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1️⃣ 사용할 도메인(재고)  구현</h3>\n<p>재고 시스템을 구축해보면서 학습을 할 에정이기 때문에 재고를 차감할 수 있는 간단한 비지니스로직을 포함한 엔티티를 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Stock</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Id</span>\n\t<span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> quantity<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Stock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Stock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> quantity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>productId <span class=\"token operator\">=</span> productId<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>quantity <span class=\"token operator\">=</span> quantity<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">decrease</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> quantity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>quantity <span class=\"token operator\">-</span> quantity <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"차감할 재고가 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>quantity <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>quantity <span class=\"token operator\">-</span> quantity<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"2️⃣간단한-jpa-repository\" style=\"position:relative;\"><a href=\"#2%EF%B8%8F%E2%83%A3%EA%B0%84%EB%8B%A8%ED%95%9C-jpa-repository\" aria-label=\"2️⃣간단한 jpa repository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2️⃣ 간단한 JPA Repository</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">StockRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Stock</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"3️⃣비지니스를-담당할-service\" style=\"position:relative;\"><a href=\"#3%EF%B8%8F%E2%83%A3%EB%B9%84%EC%A7%80%EB%8B%88%EC%8A%A4%EB%A5%BC-%EB%8B%B4%EB%8B%B9%ED%95%A0-service\" aria-label=\"3️⃣비지니스를 담당할 service permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3️⃣ 비지니스를 담당할 Service</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StockService</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">StockRepository</span> repository<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">StockService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StockRepository</span> repository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>repository <span class=\"token operator\">=</span> repository<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>propagation <span class=\"token operator\">=</span> <span class=\"token class-name\">Propagation</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REQUIRES_NEW</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 왜 새로운 트랜잭션을 열까?</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">decrease</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> quantity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Stock</span> stock <span class=\"token operator\">=</span> repository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\tstock<span class=\"token punctuation\">.</span><span class=\"token function\">decrease</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\trepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveAndFlush</span><span class=\"token punctuation\">(</span>stock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"4️⃣락을-얻고-반납하기-위한-추가-repository-구현\" style=\"position:relative;\"><a href=\"#4%EF%B8%8F%E2%83%A3%EB%9D%BD%EC%9D%84-%EC%96%BB%EA%B3%A0-%EB%B0%98%EB%82%A9%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EC%B6%94%EA%B0%80-repository-%EA%B5%AC%ED%98%84\" aria-label=\"4️⃣락을 얻고 반납하기 위한 추가 repository 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4️⃣ 락을 얻고 반납하기 위한 추가 Repository 구현</h3>\n<p>네이티브 쿼리로 직접 락 설정을 해줘야해요. 락의 이름과 해당 락의 timeout 시간을 설정합니다.</p>\n<p>해당 락은 최대 timeout 시간까지 점유하고 있을 수 있어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">LockRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Stock</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"select get_lock(:key, 3000)\"</span><span class=\"token punctuation\">,</span> nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">getLock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"select release_lock(:key)\"</span><span class=\"token punctuation\">,</span> nativeQuery <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">releaseLock</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"5️⃣facade-패턴으로-lock-을-걸고-반납하는-로직을-구현\" style=\"position:relative;\"><a href=\"#5%EF%B8%8F%E2%83%A3facade-%ED%8C%A8%ED%84%B4%EC%9C%BC%EB%A1%9C-lock-%EC%9D%84-%EA%B1%B8%EA%B3%A0-%EB%B0%98%EB%82%A9%ED%95%98%EB%8A%94-%EB%A1%9C%EC%A7%81%EC%9D%84-%EA%B5%AC%ED%98%84\" aria-label=\"5️⃣facade 패턴으로 lock 을 걸고 반납하는 로직을 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5️⃣ Facade 패턴으로 Lock 을 걸고 반납하는 로직을 구현</h3>\n<p>해당 로직으로 퍼사드 패턴으로 구현한 이유는 건물의 뼈대처럼 락을 걸고 반납하는 로직 외에 해당 클래스는 모르게 캡슐화 하고 싶었어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NamedLockStockFacade</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">LockRepository</span> repository<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">StockService</span> stockService<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">NamedLockStockFacade</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">LockRepository</span> repository<span class=\"token punctuation\">,</span> <span class=\"token class-name\">StockService</span> stockService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>repository <span class=\"token operator\">=</span> repository<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stockService <span class=\"token operator\">=</span> stockService<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Transactional</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">decrease</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> quantity<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t\trepository<span class=\"token punctuation\">.</span><span class=\"token function\">getLock</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\tstockService<span class=\"token punctuation\">.</span><span class=\"token function\">decrease</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n\t\t\trepository<span class=\"token punctuation\">.</span><span class=\"token function\">releaseLock</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"6️⃣동시성-테스트-해보기\" style=\"position:relative;\"><a href=\"#6%EF%B8%8F%E2%83%A3%EB%8F%99%EC%8B%9C%EC%84%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"6️⃣동시성 테스트 해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6️⃣ 동시성 테스트 해보기</h3>\n<p>우선 가상 상황을 만들어보자면, 100개의 재고가 있는 상품에 대해서 100명이 동시에 요청이 들어왔을 때 정상적으로 100개의 재고가 0로 변경되는 것이 보장되는가에 대한 테스트를 진행하고 싶었어요.</p>\n<p>그래서 before 에 재고가 100개인 스탁을 하나 만들어요. 그리고 100개의 쓰레드를 만든 다음  <code class=\"language-text\">countDownLatch</code> 를 사용해서 100개의 쓰레드가 한꺼번에 실행할 수있도록 대기 상태를 만듭니다. <code class=\"language-text\">countDownLatch.await()</code>  count 가 0이 될 때까지 대기했다가 0이 되면 한꺼번에 실행시킵니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootTest</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">NamedLockStockFacadeTest</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token annotation punctuation\">@Autowired</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">NamedLockStockFacade</span> stockService<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Autowired</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">StockRepository</span> stockRepository<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@BeforeEach</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Stock</span> stock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Stock</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tstockRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>stock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@AfterEach</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tstockRepository<span class=\"token punctuation\">.</span><span class=\"token function\">deleteAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token annotation punctuation\">@Test</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">consistenceProblem</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">InterruptedException</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">int</span> threadCount <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">CountDownLatch</span> countDownLatch <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CountDownLatch</span><span class=\"token punctuation\">(</span>threadCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//비동기로 실행하는 것을 단순화해서 사용할 수 있게 해줌</span>\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">ExecutorService</span> executorService <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newFixedThreadPool</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> threadCount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\texecutorService<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\tstockService<span class=\"token punctuation\">.</span><span class=\"token function\">decrease</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\tcountDownLatch<span class=\"token punctuation\">.</span><span class=\"token function\">countDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\tcountDownLatch<span class=\"token punctuation\">.</span><span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Stock</span> stock <span class=\"token operator\">=</span> stockRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertEquals</span><span class=\"token punctuation\">(</span>stock<span class=\"token punctuation\">.</span><span class=\"token function\">getQuantity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"왜-required-new-로-named-lock-을-걸어야할까\" style=\"position:relative;\"><a href=\"#%EC%99%9C-required-new-%EB%A1%9C-named-lock-%EC%9D%84-%EA%B1%B8%EC%96%B4%EC%95%BC%ED%95%A0%EA%B9%8C\" aria-label=\"왜 required new 로 named lock 을 걸어야할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 Required new 로 Named Lock 을 걸어야할까?</h2>\n<p>락을 얻은 커넥션에서만 락을 반납할 수 있는데, <strong>DB에 쿼리를 실행하는 커넥션과 락을 점유한 커넥션이 같다면?</strong> 쿼리가 종료되고 커밋되면 커넥션이 반납되는데 이 과정에서 락이 반납되지 않을 수도 있고, <strong>락을 반납할 때 락을 얻은 커넥션과 반납하는 커넥션이 달라서 락 반납이 안되는 문제도 생길 수 있어요</strong>. 또한 락을 얻는데 문제가 생기면 해당 문제가 재고 차감을 하는 로직에 영향을 주기 때문에 두 로직을 분리할 필요성을 느꼈어요. 그래서 락에 관련된 작업을 할 때는 새로운 커넥션을 열어서 해당 커넥션은 말 그래도 락을 얻고, 반납하는 용도로만 사용하고 싶어서 트랜잭션 전파레벨을 <code class=\"language-text\">required new</code> 로 해줍니다.</p>\n<h2 id=\"select-for-update-로-대신할-수는-없을까\" style=\"position:relative;\"><a href=\"#select-for-update-%EB%A1%9C-%EB%8C%80%EC%8B%A0%ED%95%A0-%EC%88%98%EB%8A%94-%EC%97%86%EC%9D%84%EA%B9%8C\" aria-label=\"select for update 로 대신할 수는 없을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Select For Update 로 대신할 수는 없을까??</h2>\n<p>현재 하고 싶은건 해당 재고 차감 작업을 할 때 다른 스레드와 작업 내역을 동기화하고 작업 내역에 대한 갱신이상이 발생하지 않도록 보장하는 것입니다! 그러면 비슷한 기능을 하는 select for update 명령어를 사용해서 구현할 수는 없을까 궁금해졌어요. 그리고 찾아보니 두가지 방법 중 namedLock 이 해당 문제를 해결하기 조금더 적합한 이유에 대해서 알게 되었는데요. select for update 는 timeout 설정이 까다로워서 락을 얻지 못하면 바로 종료시키거나, Lock 을 얻을 때까지 무한 루프에 빠지게 되는 문제가 발생할 수 있다는 점을 알게 되었어요. 그래서 <code class=\"language-text\">get_Lock(”락이름”, “타임아웃 시간”)</code> 으로 무한 루프를 대비하여 문제를 예방하는 로직이 필수적이라는 사실도 알게 되었습니다.</p>\n<h2 id=\"언제-mysql-named-lock-을-쓰면-좋을까\" style=\"position:relative;\"><a href=\"#%EC%96%B8%EC%A0%9C-mysql-named-lock-%EC%9D%84-%EC%93%B0%EB%A9%B4-%EC%A2%8B%EC%9D%84%EA%B9%8C\" aria-label=\"언제 mysql named lock 을 쓰면 좋을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>언제 MySQL named-lock 을 쓰면 좋을까?</h2>\n<p>우선 단일 WAS 환경에서 보다는 <strong>다중서버 환경에서 데이터 동기화, 정합성이 요구되는 상황이고, 인프라 구축 비용이 부담된다면 MySQL 네임드 락을 사용해서 분산환경을 구축하는것도 좋은 선택인 것 같아요</strong>. 다만 락에 대한 획득 반납에 대한 로직이 철저하게 지켜져야하고, 해당 로직에 대한 설명 또한 javaDoc 이나 wiki 로 히스토리를 남겨두어 추후 인프라가 변경되었을 때 해당 로직에 대한 리팩터링 가능성에 대해서도 코멘트 남겨주면 좋을 것 같아요.</p>\n<h2 id=\"느낀점\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\"느낀점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느낀점</h2>\n<p>분산락을 추가적인 인프라없이 구축할 수 있다는 점이 신기했고, 해당 락을 선점하는 과정에서 timeout 이 왜 필요할까 궁금했는데 동시 요청이 들어왔을 때 만약 데드락 상황이나 락을 점유할 수 없는 상황에 대한 이른 실패에 대한 로직이 구축되어 있어야 프로그램의 빠른 회복을 돕고, 혹은 다른 시도를 해볼 수 있는 상황을 만들수 있다는 것을 알게 되었습니다! ㅎㅎ 항상 트레이드 오프를 생각하고 학습을 해야 더욱 더 견고한 프로덕트를 만들 수 있을 것 같아요 너무 재밌었습니다.</p>\n<hr>\n<h2 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h2>\n<ul>\n<li><a href=\"https://techblog.woowahan.com/2631/\">분산락 우아한형제들 기술 블로그</a></li>\n<li><a href=\"https://imasoftwareengineer.tistory.com/100\">CountDownLatch</a></li>\n<li><a href=\"https://gdtbgl93.tistory.com/142\">퍼사드 패턴</a></li>\n<li><a href=\"https://www.inflearn.com/course/%EB%8F%99%EC%8B%9C%EC%84%B1%EC%9D%B4%EC%8A%88-%EC%9E%AC%EA%B3%A0%EC%8B%9C%EC%8A%A4%ED%85%9C#curriculum\">재고 시스템으로 알아보는 동시성 이슈</a></li>\n</ul>","frontmatter":{"date":"January 01, 2023","title":"NamedLock - [재고 시스템으로 알아보는 동시성 이슈]","categories":"spring","author":"수달","emoji":"🙂"},"fields":{"slug":"/concurrency/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://her0807.com","comments":{"utterances":{"repo":"https://github.com/her0807/her0807.github.io"}}}}},"pageContext":{"slug":"/etc2/","nextSlug":"/concurrency/","prevSlug":""}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}