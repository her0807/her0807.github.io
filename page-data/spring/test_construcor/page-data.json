{"componentChunkName":"component---src-templates-blog-template-js","path":"/spring/test_construcor/","result":{"data":{"cur":{"id":"65ad6ce1-0312-581f-8ac9-8ab97ce982c9","html":"<h2 id=\"학습동기\" style=\"position:relative;\"><a href=\"#%ED%95%99%EC%8A%B5%EB%8F%99%EA%B8%B0\" aria-label=\"학습동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>학습동기</h2>\n<p>prolog project test code 를 작성하다가 생성자 주입과 autowired 로 의존성 주입을 하는 방식 모두를 사용하고 있는 코드를 발견했어요. 왜 junit 을 사용하는 test 에서 두개의 의존성 주입 방식을 사용하게 된걸까요?  이전부터 궁금했던건데 테스트 코드에서는 의존성 주입 방식을 무조건 autowired 로 해야하는지도 의문이 들었어요.</p>\n<h2 id=\"문제-코드\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%BD%94%EB%93%9C\" aria-label=\"문제 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 코드</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@TestConstructor</span><span class=\"token punctuation\">(</span>autowireMode <span class=\"token operator\">=</span> <span class=\"token class-name\">TestConstructor<span class=\"token punctuation\">.</span>AutowireMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@NewIntegrationTest</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">KeywordServiceTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">KeywordService</span> keywordService<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">SessionRepository</span> sessionRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">KeywordRepository</span> keywordRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EntityManager</span> em<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">KeywordServiceTest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">KeywordService</span> keywordService<span class=\"token punctuation\">,</span>\n                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">SessionRepository</span> sessionRepository<span class=\"token punctuation\">,</span>\n                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">KeywordRepository</span> keywordRepository<span class=\"token punctuation\">,</span>\n                              <span class=\"token keyword\">final</span> <span class=\"token class-name\">EntityManager</span> em<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>keywordService <span class=\"token operator\">=</span> keywordService<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sessionRepository <span class=\"token operator\">=</span> sessionRepository<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>keywordRepository <span class=\"token operator\">=</span> keywordRepository<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>em <span class=\"token operator\">=</span> em<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"결론부터-말씀드리자면-testclass-에서는-하나의-의존성-주입-방식을-사용하고-있어요\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0%EB%B6%80%ED%84%B0-%EB%A7%90%EC%94%80%EB%93%9C%EB%A6%AC%EC%9E%90%EB%A9%B4-testclass-%EC%97%90%EC%84%9C%EB%8A%94-%ED%95%98%EB%82%98%EC%9D%98-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A3%BC%EC%9E%85-%EB%B0%A9%EC%8B%9D%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B3%A0-%EC%9E%88%EC%96%B4%EC%9A%94\" aria-label=\"결론부터 말씀드리자면 testclass 에서는 하나의 의존성 주입 방식을 사용하고 있어요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론부터 말씀드리자면 TestClass 에서는 하나의 의존성 주입 방식을 사용하고 있어요.</h2>\n<p>테스트 코드를 작성하기 위해 사용하는 라이브 러리인 Junit 에서는 스프링과 별개로 의존성 주입을 하고 있어요.그래서 위 코드에서 생성자를 만든건 생성자로 의존성을 주입하기 위해서가 아니었더라구요. 각각 @autowired 를 달아주는 번거로움을 해소하고자 <code class=\"language-text\">@TestConstructor(autowireMode = TestConstructor.AutowireMode.*ALL*)</code>  어노테이션으로 생성자 위에 autowired 를 달아준 것과 같은 효과를 내기 위해서 였어요.</p>\n<p>@autowired 로 의존성을 주입하지 않으면 <code class=\"language-text\">ParameterResolutionException</code>  이 발생해요.  이유는  JUnit Engine의 <strong>Parameter Resolver 인터페이스에 의해 의존성 주입이 되기 때문인데요.</strong></p>\n<h2 id=\"parameter-resolver\" style=\"position:relative;\"><a href=\"#parameter-resolver\" aria-label=\"parameter resolver permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>Parameter Resolver</strong></h2>\n<p>어뎁터 페턴을 사용하여 상황별로 맞는 리졸버를 가리기 위한 인터페이스 입니다.</p>\n<p>@SpringBootTest 에서 있는 SpringExtension.class 가 바로 <strong>Parameter Resolver  를 상속받아 구현되어 있어요.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringExtension</span> <span class=\"token keyword\">implements</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>ParameterResolver <span class=\"token punctuation\">{</span></code></pre></div>\n<p>그리고 하위에 있는 supportsParameter 메서드에서는 isAutowirableConstructor 메서드로 어노테이션을 확인하구요.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">supportsParameter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ParameterContext</span> parameterContext<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ExtensionContext</span> extensionContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n     <span class=\"token keyword\">return</span> <span class=\"token class-name\">TestConstructorUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAutowirableConstructor</span><span class=\"token punctuation\">(</span>executable<span class=\"token punctuation\">,</span> testClass<span class=\"token punctuation\">,</span> junitPropertyProvider<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token class-name\">ApplicationContext</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAssignableFrom</span><span class=\"token punctuation\">(</span>parameter<span class=\"token punctuation\">.</span><span class=\"token function\">getType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">supportsApplicationEvents</span><span class=\"token punctuation\">(</span>parameterContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token class-name\">ParameterResolutionDelegate</span><span class=\"token punctuation\">.</span><span class=\"token function\">isAutowirable</span><span class=\"token punctuation\">(</span>parameter<span class=\"token punctuation\">,</span> parameterContext<span class=\"token punctuation\">.</span><span class=\"token function\">getIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span></code></pre></div>\n<p>더 내부에서는 testConstructor 를 통해서도 Autowired 를 확인해줍니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAutowirableConstructor</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constructor</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> constructor<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> testClass<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">PropertyProvider</span> fallbackPropertyProvider<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AnnotatedElementUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasAnnotation</span><span class=\"token punctuation\">(</span>constructor<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Autowired</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token class-name\">AutowireMode</span> autowireMode <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n      <span class=\"token class-name\">TestConstructor</span> testConstructor <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">TestConstructor</span><span class=\"token punctuation\">)</span><span class=\"token class-name\">TestContextAnnotationUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">findMergedAnnotation</span><span class=\"token punctuation\">(</span>testClass<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TestConstructor</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>testConstructor <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          autowireMode <span class=\"token operator\">=</span> testConstructor<span class=\"token punctuation\">.</span><span class=\"token function\">autowireMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token class-name\">String</span> value <span class=\"token operator\">=</span> <span class=\"token class-name\">SpringProperties</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spring.test.constructor.autowire.mode\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          autowireMode <span class=\"token operator\">=</span> <span class=\"token class-name\">AutowireMode</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>autowireMode <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> fallbackPropertyProvider <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              value <span class=\"token operator\">=</span> fallbackPropertyProvider<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spring.test.constructor.autowire.mode\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              autowireMode <span class=\"token operator\">=</span> <span class=\"token class-name\">AutowireMode</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> autowireMode <span class=\"token operator\">==</span> <span class=\"token class-name\">AutowireMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"왜-junit-5은-생성자-의존성-주입을-못할까\" style=\"position:relative;\"><a href=\"#%EC%99%9C-junit-5%EC%9D%80-%EC%83%9D%EC%84%B1%EC%9E%90-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A3%BC%EC%9E%85%EC%9D%84-%EB%AA%BB%ED%95%A0%EA%B9%8C\" aria-label=\"왜 junit 5은 생성자 의존성 주입을 못할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 Junit 5은 생성자 의존성 주입을 못할까?</h2>\n<blockquote>\n<p>Jupiter vs Spring 환경 차이 때문에!</p>\n</blockquote>\n<ul>\n<li>스프링 프레임워크의 경우 <strong>Spring Ioc 컨테이너</strong>가 등록할 <strong>Bean</strong> 들을 먼저 찾아서 보관하고 있어요\n<ul>\n<li>이후 생성자 주입을 요구하는경우, 적절한 Bean을 찾아서 생성자 주입을 수행하게 돼요</li>\n</ul>\n</li>\n<li>테스트 프레임 워크의 경우 생성자 매개 변수 관리를 <strong>Jupiter</strong>가 하게됩니다</li>\n<li>생성자 주입을 요구하는경우, 생성자 매개변수를 처리할 <strong>ParameterResolver</strong>을 열심히 뒤져보게 되지만, 해당 빈은 스프링이 가지고 있기때문에 처리하지 못하게돼요\n<ul>\n<li>이 때문에 <strong>나 못찾았어!</strong> 하고, <code class=\"language-text\">ParameterResolutionException</code> 에러가 발생하게 되는거죠!</li>\n</ul>\n</li>\n<li>하지만 <code class=\"language-text\">@AutoWired</code> 어노테이션을 달아 명시해 주게 된다면, <strong>Jupiter</strong>가 빈 주입을 <strong>스프링 컨테이너</strong>에게 요청하게 되어서, 정상적으로 빈 주입을 받을 수 있게돼요 ㅎㅎ</li>\n</ul>\n<h2 id=\"왜-왜-junit-을-사용해서-테스트를-짜야할까\" style=\"position:relative;\"><a href=\"#%EC%99%9C-%EC%99%9C-junit-%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%84%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8%EB%A5%BC-%EC%A7%9C%EC%95%BC%ED%95%A0%EA%B9%8C\" aria-label=\"왜 왜 junit 을 사용해서 테스트를 짜야할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 왜 Junit 을 사용해서 테스트를 짜야할까?</h2>\n<p>그렇다면 처음부터 스프링과 자바만으로 테스트 코드를 짜면 되지 않나? 라는 생각이 드는데요! 자바로만 테스트 코드를 짜면 어플리케이션을 실행시켜야하고, 잘 테스트가 되었는지 단위별로 확인이 가능할까요? 가능할 수도 있지만 정말 힘들 거예요. 학부생 시절 때 <code class=\"language-text\">system.out.println()</code> 을 사용해서 콘솔에 데이터를 찍어가며 하나 하나 확인 했던 적이 있었는데 진짜 힘들었거든요..</p>\n<p>그래서 이런 문제를 해소하기 위해서 JUnit 에서는 단위별로 프로그램을 실행하고, 검증하고, 결과를 반환하는 인련의 기능들을 구현하고 있는데요 ! 가장 큰 특징은 아래와 같아요. ☺️</p>\n<ul>\n<li>단정 문으로 테스트 케이스의 수행 결과를 판별함(assertEquals(예상 값, 실제 값))</li>\n<li>JUnit4부터는 어노테이션으로 간결하게 테스트를 지원함</li>\n<li>결과는 <code class=\"language-text\">성공(녹색), 실패(붉은색) 중 하나로 표시</code></li>\n</ul>\n<h2 id=\"느낀점\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\"느낀점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느낀점</h2>\n<p>단위 테스트가 가능해진 덕분에 안정한 코드와 리팩터링하기 무서운 마음을 해소할 수 있다는 것을 느껴요.  <strong>이런 기능을 제공하기 위해서 Jupiter가  Spring Bean 을 직접 관리하지 못하고  Spring 에게 요청해야하는 인련의 과정이 있다는것을 알게되며 정말 즐거웠어요!</strong> 직접 빈을 주입시키지 못하기 때문에 필드 각각 autowired 를 해줘야하는 상황을 개선하기 위해 <code class=\"language-text\">@TestConstructor</code>  과 같은 기능들을 만든 것을 보면서 불편한 상황에서 개선점을 찾기 위한 자세도 너무 좋았어요.</p>\n<h2 id=\"참고-자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0-%EC%9E%90%EB%A3%8C\" aria-label=\"참고 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고 자료</h2>\n<ul>\n<li><a href=\"https://junit.org/junit5/docs/current/user-guide/#writing-tests-dependency-injection\">공식문서</a></li>\n<li><a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/context/TestConstructor.html\">관련 블로그</a></li>\n</ul>","excerpt":"학습동기 prolog project test code 를 작성하다가 생성자 주입과 autowired 로 의존성 주입을 하는 방식 모두를 사용하고 있는 코드를 발견했어요. 왜 junit 을 사용하는 test 에서 두개의 의존성 주입 방식을 사용하게 된걸까요?  이전부터 궁금했던건데 테스트 코드에서는 의존성 주입 방식을 무조건 autowired 로 해야하는지도 의문이 들었어요. 문제 코드 결론부터 말씀드리자면 TestClass 에서는 하나의 의존성 주입 방식을 사용하고 있어요. 테스트 코드를 작성하기 위해 사용하는 라이브 러리인 Junit 에서는 스프링과 별개로 의존성 주입을 하고 있어요.그래서 위 코드에서 생성자를 만든건 생성자로 의존성을 주입하기 위해서가 아니었더라구요. 각각 @autowired 를 달아주는 번거로움을 해소하고자   어노테이션으로 생성자 위에 autowired 를 달아준 것과 같은 효과를 내기 위해서 였어요. @autowired 로 의존성을 주입하지 않으면   이 …","frontmatter":{"date":"December 12, 2022","title":"SpringBootTest 에서 의존성 주입 방식이 @autowired 로 강제되는 이유","categories":"spring","author":"수달","emoji":"🙂"},"fields":{"slug":"/spring/test_construcor/"}},"next":{"id":"cb19b23b-99ee-54f4-a73c-49d1ceebcc52","html":"<h2 id=\"언두-로그란\" style=\"position:relative;\"><a href=\"#%EC%96%B8%EB%91%90-%EB%A1%9C%EA%B7%B8%EB%9E%80\" aria-label=\"언두 로그란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>언두 로그란?</h2>\n<blockquote>\n<p>myql 8.0 기준으로 DB 에서 트랜잭션과 격리 수준을 보장하기 위해서 InnoDB 스토리지 엔진을 사용하는 방법이 있어요.</p>\n</blockquote>\n<p>트랜잭션과 격리 수준을 보장하기 위해서 DML(INSERT, UPDATE, DELETE) 로 변경 요청이 들어오면 변경전, <strong>이전 버전의 데이터를 언두로그라는 공간에 백업해요.</strong></p>\n<h3 id=\"트랜잭션-보장\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%B3%B4%EC%9E%A5\" aria-label=\"트랜잭션 보장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트랜잭션 보장</h3>\n<p>트랜잭션이 롤백되면, <code class=\"language-text\">도중에 변경된 데이터를 변경 전 데이터로 복구</code>해야 하는데, 이때 언두 로그에 백업해둔 이전 버전의 데이터를 이용해 복구해요.</p>\n<h3 id=\"격리-수준-보장\" style=\"position:relative;\"><a href=\"#%EA%B2%A9%EB%A6%AC-%EC%88%98%EC%A4%80-%EB%B3%B4%EC%9E%A5\" aria-label=\"격리 수준 보장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>격리 수준 보장</h3>\n<p>특정 커넥션에서 <code class=\"language-text\">데이터를 변경하는 도중</code>에 <code class=\"language-text\">다른 커넥션</code>에서 데이터를 조회하면 트랜잭션 격리 수준에 맞게 변경중인 레코드를 읽지 않고 <code class=\"language-text\">언두로그에 백업해둔 데이터를 읽어서 반환</code> 하기도 합니다.  (READ COMMITED 이상의 격리수준에서는 트랜잭션이 열려있는 데이터에 경우, 언두로그를 먼저 읽습니다.</p>\n<h2 id=\"언두로그-소멸-시점\" style=\"position:relative;\"><a href=\"#%EC%96%B8%EB%91%90%EB%A1%9C%EA%B7%B8-%EC%86%8C%EB%A9%B8-%EC%8B%9C%EC%A0%90\" aria-label=\"언두로그 소멸 시점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>언두로그 소멸 시점</h2>\n<p>그렇다면, 언두로그는 백업용 임시 공간이라는 소리인데, <em>언제까지 메모리에 남아있을까요?</em></p>\n<p>언두로그는 롤백을 하거나, 트랜잭션과 격리할 때 사용하기 때문에 트랜잭션이 종료되면 더이상 필요 없어져서  종료 되지 않을까? 추측해보았어요.</p>\n<p>결론은 <em>바로 사라지진 않는다.</em> 입니다.</p>\n<blockquote>\n<p>트랜잭션이 완료 되었다고 해서 해당 트랜잭션이 생성한 언두로그를 즉시 삭제할 수 있는 것은 아니다. 트랜잭션이 A,B,C 가 있다고 가정하고, 서로 시작과 종료 시점이 다르게 실행 되었을 때. B,C 트랜잭션이 완료되었지만 A 트랜잭션이 아직 활성 상태에 있다면 언두로그는 계속 보존된다. ( 여기서 보존된다는 의미는 read uncommited 격리 수준 이상일 때 요청이 들어오면 언두 영역을 먼저 읽는다는 의미로 이해했습니다.) <br><br></p>\n</blockquote>\n<p><em>개발자와 DBA를 위한 실전 가이드 RealMySql 8.0 책 p.123 에서 발췌</em></p>\n<p>삭제는 언제될까? 해당 내용은 <code class=\"language-text\">언두로그가 데이터를 관리하는 방식</code>을 알게되면 알 수 있어요.</p>\n<h2 id=\"언두-테이블-스페이스-관리\" style=\"position:relative;\"><a href=\"#%EC%96%B8%EB%91%90-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4-%EA%B4%80%EB%A6%AC\" aria-label=\"언두 테이블 스페이스 관리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>언두 테이블 스페이스 관리</h2>\n<blockquote>\n<p>언두로그가 저장되는 공간을 언두 테이블 스페이스(Undo Tablespace)</p>\n</blockquote>\n<p>우선 언두 테이블 스페이스가 대략 얼마나 메모리를 차지하는지 이해하기 위해서 테이블 스페이스를 관리하는 방법에 대해서 간단히 설명하겠습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 567px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEF0lEQVQ4yz3TSYtjVRQH8OfStbhw51dwYy9diVvBDyCubBqpqq6iUqmkMr28OW/OS/KmzHlJZZ6HqkrSZSsKNrhQWkVBpIXWRm1pW6E1yT1yX6OLw7138+N/DucSHJuoZQz5cSGffVAuWz8ZafGhrgmPJJH5RRKZ32SJeZxIhH8XhOQTQUg+1XXhT8MQ/8pl5X84LvEkGLxN33z/vVckiSZsS3uBkGXmnusY0KgXwau5gO/Vig2Vsg3FQg5KRRMsS4O8a4DrGv6Jq1wyQZYZ4LkExGOnP58EDt7h2DhByBJ9z7Y0aDQKG8c2dmlN3JUKOZQ1FFQsmKhRL6JsRkaSxCDL0lCpZKJ8PoOKxRzSVB7xXOIZw8QgFj2pSCJNEIrMfuHYOk63G/Qb6Hq9gOv1HC3mQ/j0kztw77O70O140GxWoFyyQJZZME0VlUo5lM1IiGFiG5qOAkmGWz6oqtzXjpMGz3N33W4NTcYdGI860GnXYTbtw2I+gHarCleXY+h0PP9dq7qQz2fAcdKISp5tcUKaiq7v3/+cINIa/13eSUPdc3a9rocuFkO4vBjBZNyF6+sL+PD6Agb9c7i6HEGvW4f1agrN8xIU8hk8U0RTka0gJIFlYl/eeP21F4m0xn2fdzTwPMdvGWM4DU66Xs1htZz60GIx8OHlcgKtVvk/EEM7WaKBoaMP3nrzjZcITWV+cB0NGnV31+vW0HTS9dNgEGPLq7EPTSd4FG2YTXvQ7dSgUMj6bQs8iRSZBZqKPDs8uPUqoWvcj7atQq1m70aDBsLAejWByajjJ8U4hsajFsxnfX8Uw0ETXCfto2KKQpJII46NQTIRukFk0sJD21LAcbRdv+uhO+uZPyecZHU1+T/hsH8O83nPxzBumiqU8C5KDEoJ5C7FJ4Chzt4mskbqV8dWIZeTUcPLo+XlGD7+6Or5DJdTWC2fg7Np10cxhu9mToVq1QZN5ZDAxbeKxABFnt4kDF34w7E0MHMKymVlhFtpNoow7J1Dv9eAgpv11wZDo2ELlssxzKYdwLtbqVigKiwSU+RGUxigyRBFGHrqqWvpYOVUZJkqwktbyGdQu1lG540StJoV1GnXULGQQ512FV1eDBDeBvxTPM9FusYjRaY3okACz0SLhK7yGAMzq2xtS9u6ruGXY+sbM6ts0npqo2vCRlO5jSwzGzGV3Coys9U1fpvWhS1DneH33zwbA46OdIiz8PGtcOjo23DoCIKBAwieHMBJANc+HB19AKfBQ4icHUM0EoB4LAhJMgQUGQaKDAEZDwIZCwJLR4GlIyBw8a+IjCERwcDBy4Hj/QyZCH3DMrG7HBtf8jw5iceCXZaJ1WSZsSSJViSRoiWRCksidSyL9GFKIPdYOrLHUpF3k/HT26eB/b1/AbPkXXECQzpBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"언두로그.png\"\n        title=\"언두로그.png\"\n        src=\"/static/9139668bbfeae012372d741b2e0c8537/8710b/undolog.png\"\n        srcset=\"/static/9139668bbfeae012372d741b2e0c8537/e9ff0/undolog.png 180w,\n/static/9139668bbfeae012372d741b2e0c8537/f21e7/undolog.png 360w,\n/static/9139668bbfeae012372d741b2e0c8537/8710b/undolog.png 567w\"\n        sizes=\"(max-width: 567px) 100vw, 567px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><em>하나의 트랜잭션이 필요로 하는 언두 슬롯의 개수는 트랜잭션이 실행하는 DML 의 개수에 따라 최대 4개까지 언두 슬롯을 사용하게 된다.  일반적으로 트랜잭션이 임시 테이블을 사용하지 않으므로 하나의 트랜잭션은 대략 2개 정도의 언두 슬롯을 필요로 한다고 가정하면 된다. 그래서 최대 동시 처리 가능한 트랜잭션의 개수는 다음 수식으로 예측 해볼 수 있다.</em></p>\n<blockquote>\n<p>최대 동시 트랜잭션 수 = (InnoDB 페이지 크기) / 16 * (롤백 세그먼트 개수) * (언두 테이블 스페이스 개수)</p>\n</blockquote>\n<p><strong>가장 일반적인 설정인 16KB InnoDB 에서 기본 설정</strong>(innodb_undo_tablespaces=2 , innodb_rollback segments =128) 을 사용한다고 가정했을 때, 대략 <code class=\"language-text\">131072</code> 개 정도의 트랜잭션을 동시에 처리가 할수 있어요.</p>\n<p>트랜잭선 하나당 언두 테이블 스페이스가 만들어지고, 해당 공간에 데이터를 1000개 씩 적재한다고 가정하면,  엄청난 양의 메모리를 사용하겠죠? .. 🥲 똑똑한 RDBMS 는 이 문제점을 알고, 해결할 방법을 찾았습니다.</p>\n<h2 id=\"undo-table-space-truncate\" style=\"position:relative;\"><a href=\"#undo-table-space-truncate\" aria-label=\"undo table space truncate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Undo table space truncate</h2>\n<blockquote>\n<p>언두 테이블 스페이스 공간을 필요한 만큼만 남기고 나머지를 운영체제로 반납하는 것을 <code class=\"language-text\">Undo table space truncate </code> 라고 한다.</p>\n</blockquote>\n<p>바로 특정 시점에 언두 로그 영역을 삭제하는 건데요. mysql 에서는 자동 모드와 수동 모드 두가지를 지원한다고 합니다.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">자동 모드</code></p>\n<p>트랜잭션이 커밋되면, 더이상 언두로그에 복사된 이전 값은 불필요해집니다. InnoDB 스토리지 엔진의 퍼지 스레드(Purge Thread) 는 주기적으로 깨어나서 언두 로그 공간에서 불 필요해진 언두 로그를 삭제하는 작업을 시행하는데 이 작입을 <code class=\"language-text\">언두 퍼지스</code>라고 합니다. MySql 서버의 inndb_undo_log_truncate 시스템 변수가 ON 으로 설정되면 활성화 시킬 수 있습니다.</p>\n</li>\n</ul>\n<p>언두 퍼지스의 동작 원리가 궁금하시다면 <a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-purge-configuration.html\">공식 문서</a>를 읽어보세요 ☺️</p>\n<ul>\n<li>\n<p><code class=\"language-text\">수동 모드</code></p>\n<p>시스템 변수가 OFF 라서 언두 로그 파일의 잘라내기가 자동으로 되지 않거나 반납이 부진할 때, 언두 테이블 스페이스를 비활성화해서 언두 테이블이 더이상 사용되지 않도록 설정하면 퍼지 스레드는 비활성 상태의 언두 테이블 스페이스를 찾아서 공간을 반납한다. 반납이 완료되면 다시 언두 에티블 스페이스를 활성화 시킨다. 언두 테이블 스페이스가 최소 3개 이상 되야 수동모드를 작동할 수 있다.</p>\n</li>\n</ul>\n<h2 id=\"체인지-버퍼-change-buffer\" style=\"position:relative;\"><a href=\"#%EC%B2%B4%EC%9D%B8%EC%A7%80-%EB%B2%84%ED%8D%BC-change-buffer\" aria-label=\"체인지 버퍼 change buffer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>체인지 버퍼 (Change Buffer)</h2>\n<blockquote>\n<p>RDBMS에서 레코드가 INSERT 되거나 UPDATE 될 때 해당 테이블에 포함된 인덱스도 업데이트 하는 작업이 필요합니다. 인덱싱 작업은 랜덤하게 디스크를 읽는 작업이 필요하므로 테이블에 인덱스가 많다면 이 작업은 상당히 많은 자원을 소모하게 되겠죠 ?  그래서 InnoDB 는 변경해야할 인덱스 페이지가 버퍼 풀에 있으면 바로 업데이트를 수행하지만, 그렇지 않고 디스크로부터 읽어와야한다면 임시 공간에 저장해두고 사용자에게 바로 반환해서 성능을 향상시켜요. 이때 사용하는 임시 공간이 체인지 버퍼라고 합니다. ☺️</p>\n</blockquote>\n<h2 id=\"리두-로그-간단히-알기\" style=\"position:relative;\"><a href=\"#%EB%A6%AC%EB%91%90-%EB%A1%9C%EA%B7%B8-%EA%B0%84%EB%8B%A8%ED%9E%88-%EC%95%8C%EA%B8%B0\" aria-label=\"리두 로그 간단히 알기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리두 로그 간단히 알기</h2>\n<blockquote>\n<p>리두 로그(Redo Log)는 트랜잭션의 4가지 요소인 ACID 중 Durable 에 해당하는 영속성과 가장 밀접하게 연관돼 있어요. <br><br> p.131</p>\n</blockquote>\n<h3 id=\"리두-로그\" style=\"position:relative;\"><a href=\"#%EB%A6%AC%EB%91%90-%EB%A1%9C%EA%B7%B8\" aria-label=\"리두 로그 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>리두 로그</h3>\n<p>하드웨어나 소프트웨어 등 여러가지 문제점으로 인해 mysql 서버가 비정상적으로 종료 되었을 때, 데이터 파일에 기록되지 못한 데이터를 잃지 않게 해주는 안정장치를 말해요. 체인지 버퍼에서 임시 공간에 저장된 친구들을 리두로그에 먼저 기록해두어서 비정상으로 서버가 종료되면 복구할 때 사용하는 기능이 <code class=\"language-text\">리두 로그</code> 랍니다.</p>\n<h2 id=\"느낀점\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\"느낀점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느낀점</h2>\n<p>트랜잭션 격리 레벨을 학습하다가 InnoDB 까지 오게 되었는데 격리 레벨을 보장하기 위해서 언두로그를 사용한다고 해서 학습을 하게 되었어요. 언두로그의 생명주기를 알게되니 격리 레벨을 이해하는데 훨씬 도움이 될 것 같습니다.</p>\n<h2 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h2>\n<ul>\n<li><a href=\"http://www.yes24.com/Product/Goods/6960931\">Real MySQL</a></li>\n<li><a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-purge-configuration.html\">MySQL 8.0 공식 문서</a></li>\n</ul>","frontmatter":{"date":"October 24, 2022","title":"InnoDB 언두 로그과 리드 로그","categories":"db","author":"수달","emoji":"🙂"},"fields":{"slug":"/undo/"}},"prev":{"id":"f222096b-2607-5cb2-a280-ee86a173f0d8","html":"<h2 id=\"아름다움\" style=\"position:relative;\"><a href=\"#%EC%95%84%EB%A6%84%EB%8B%A4%EC%9B%80\" aria-label=\"아름다움 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>아름다움.</h2>\n<p>아름답기 때문에 사랑하는 것일까, 사랑해서 아름다워 보이는 걸까? 사랑하는 사람이 전화를 하거나 말을 하는 모습을 보면서 우리는 왜 이 목의 곡선이나 보조개가 매력있게 다가오는지 묻게 된다.</p>\n<p><strong>사랑은 아름다움에 욕망이라는 마르실리오 피치노라는 이탈리아 철학자</strong>의 말이 맞다면, 내가 사랑하는 사람은 어떤 방식으로 나의 욕망을 충족시킬까?</p>\n<p>아름다움은 객관적인 기준에 따라서 측정할 수 있는걸까. 우리가 잘생기고 예쁘다고 생각하는 사람들의 얼굴에는 수학적 기초가 담겨있다. 따라서 잡지 표지 모델에 얼굴이 즐거움을 주는 것은 우연이라기보다 필연이다.</p>\n<p>플라톤과 레온 바티스타 알베르티는 그들의 미학 이론에서 뭔가를 빠트린것이 틀림 없다. 나는 내가 사랑하는 사람이 지나치게 아름답다고 생각했기 때문이다. 내가 그의 보조개와 짙은 눈썹을 좋아했던 것일까?  그 사람의 매력 요소를 뽑는것이 명확하게 어떤 특징 때문이 아니라서 망설여진다.</p>\n<p>그림을 볼 때도 어떤 그림은 내게 완벽한 감동을 주는 반면, 아무 감흥이 없는 그림도 있다. 이것을 우리는 어떻게 설명할 수 있을까?</p>\n<p>내가 묘사할 수 있는 것은 아름다움이 아니라, 그 사람에 대한 나의 주관적인 반응 뿐이다. 아름다움은 객관적 기준이라는 플라톤적 관념을 배격하고 <strong>대신 미학적 판단은 결정 근거가 주관적일 수 밖에 없다는 칸트의 판단력 비판</strong>에 나오는 견해에 동조할 수 밖에 없다.</p>\n<br>\n<h3 id=\"뮐러-리어-착시-현상\" style=\"position:relative;\"><a href=\"#%EB%AE%90%EB%9F%AC-%EB%A6%AC%EC%96%B4-%EC%B0%A9%EC%8B%9C-%ED%98%84%EC%83%81\" aria-label=\"뮐러 리어 착시 현상 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>뮐러 리어 착시 현상</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA10lEQVQY05WRyYqEQBBE6/+/wR/wpHhVUDyKuCE9XvTiCi4wNVY57RZDJcy1pyfhkaeMjMhkQghIKXDfN5ZlwTzPUHWeJ67resm+76jrmma3bYOUEuxrXWk4iiJomkY9TVMkSfKSOI6R5zkMw4Cu6ySozDEhJDkqigKmaaKqKrRti6Zp/qTrOnieB8dxcBwHOWYq4sfjQaJqy7queLdU1N8T9X2PsizBvp9PZFkGy7IoRhiGCILgbVR813Vh2zY452CfnMP3fYqsnjKOI6Zp+hfDMJCGOtcPnW23wUNghIAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"뮐러리어_착시현상.png\"\n        title=\"뮐러리어_착시현상.png\"\n        src=\"/static/ebf53d8d0a64a6096f02e8978054e971/37523/%EB%AE%90%EB%9F%AC%EB%A6%AC%EC%96%B4_%EC%B0%A9%EC%8B%9C%ED%98%84%EC%83%81.png\"\n        srcset=\"/static/ebf53d8d0a64a6096f02e8978054e971/e9ff0/%EB%AE%90%EB%9F%AC%EB%A6%AC%EC%96%B4_%EC%B0%A9%EC%8B%9C%ED%98%84%EC%83%81.png 180w,\n/static/ebf53d8d0a64a6096f02e8978054e971/f21e7/%EB%AE%90%EB%9F%AC%EB%A6%AC%EC%96%B4_%EC%B0%A9%EC%8B%9C%ED%98%84%EC%83%81.png 360w,\n/static/ebf53d8d0a64a6096f02e8978054e971/37523/%EB%AE%90%EB%9F%AC%EB%A6%AC%EC%96%B4_%EC%B0%A9%EC%8B%9C%ED%98%84%EC%83%81.png 720w,\n/static/ebf53d8d0a64a6096f02e8978054e971/302a4/%EB%AE%90%EB%9F%AC%EB%A6%AC%EC%96%B4_%EC%B0%A9%EC%8B%9C%ED%98%84%EC%83%81.png 1080w,\n/static/ebf53d8d0a64a6096f02e8978054e971/58354/%EB%AE%90%EB%9F%AC%EB%A6%AC%EC%96%B4_%EC%B0%A9%EC%8B%9C%ED%98%84%EC%83%81.png 1396w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이런 상황은 뮐러-리어의 착시와 비교될 수 있다. 이 착시에서는 길이가 똑같은 두 선이 끝에 다른 화살표가 붙어있다는 것 만으로도 길이가 다르게 보인다. 내가 상대방을 바라보는 애정 어린 눈길은 밖으로 연린 화살표와 같은 역할을 했다. 그런 화살표가붙으면 평범한 선도 객관적인 측정치와 관계 없이 길어보인다.</p>\n<p>스탈당이 말하길 아름다움은 행복의 약속이다.  실제 그의 얼굴이 내가 생각하는 좋은 삶과 동일시 하는 특징을 가지고 있었다. 그의 코는 유머가 있었고, 빨개지는 귀는 순수했고 자주 보여주는 보조개는 긍정적인 태도를 암시했다.</p>\n<p>완벽함을 추구하는 것에는 어떤 압제가 있다. 심지어 어떤 실증이 느껴진다. 과학적 공식과 같은 힘으로 자신을 내세우는 것 같기 때문이다. 수학적 비율이 주는 편안함에 안주하지 않고, 내 감정에 맞추어 아름다움이 좌우된다면 그게 더 재미있지 않을까?</p>\n<p>고전적으로 아름다운 사람은 내게 상상력의 여지를 남기지 않는다.</p>\n<br>\n<h3 id=\"상상력에-따라-달라지는-해석\" style=\"position:relative;\"><a href=\"#%EC%83%81%EC%83%81%EB%A0%A5%EC%97%90-%EB%94%B0%EB%9D%BC-%EB%8B%AC%EB%9D%BC%EC%A7%80%EB%8A%94-%ED%95%B4%EC%84%9D\" aria-label=\"상상력에 따라 달라지는 해석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>상상력에 따라 달라지는 해석</h3>\n<p>비트겐 슈타인의 오리 그림은 상상력에 따라서 토끼가 보이기도 한다. 중요한 것은 보는 사람의 경향이다. 나의 영혼으로 상대방에게 생기를 불어 넣었던 것이다. 보는 사람의 관점에서 아름다움을 찾는다면, 보는 사람이 시선을 거둘 때 어떤 일이 벌어질까? 그러나 어쩌면 그것 역시 삶이 주는 매력의 한 부분이었는지도 모른다. 그리고 아름다움에 관한 주관적 이론은 내가 사랑하는 사람을 없어서는 안될 존재로 만들어 버리므로.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABUElEQVQoz31SX+uCQBD0+0Ofo1dfeg36T0JWhGilRmVFJhjkg6Q1P2Z/3HEGNbBwt8fO3uys9X6/8Q18M+P1ekmoGpUz7xYPZVliu91itVphvV7jdDqhKAr8Aok+mxNCuN/v0e/3EUURbrcbrtcrzucz4jjG5XJBVVUSSZJgPp9jMpnAcRyMRiO5N36oOvGy2+1wOBwQRaEU53kuucVigdlsJgqYN8H34XDYlMyO4/FYZKdpCt/30el0JM9fk+T5fGoS27YxGAz03ZlORZGWHIYher0egiCQ+ZHgeDzKKJjzPO/fgLqWona7jVarpQnv97tIF0Kl//F4YLPZSFAGyfjj5XIps2KROXzTZcJ1XTHX+uaYuQ50vNvt6re6rvUKEVmWyXwbPzRJzCBoDh3/3E2CW0EVCtavRTaLTMkqz1lTqjJMu/wL35pQjblCarH/AKNqR2ypyXT7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"비트겐슈타인_오리.png\"\n        title=\"비트겐슈타인_오리.png\"\n        src=\"/static/ee6c3bd067184c1c22a417c8eecc00de/37523/%EB%B9%84%ED%8A%B8%EA%B2%90%EC%8A%88%ED%83%80%EC%9D%B8_%EC%98%A4%EB%A6%AC.png\"\n        srcset=\"/static/ee6c3bd067184c1c22a417c8eecc00de/e9ff0/%EB%B9%84%ED%8A%B8%EA%B2%90%EC%8A%88%ED%83%80%EC%9D%B8_%EC%98%A4%EB%A6%AC.png 180w,\n/static/ee6c3bd067184c1c22a417c8eecc00de/f21e7/%EB%B9%84%ED%8A%B8%EA%B2%90%EC%8A%88%ED%83%80%EC%9D%B8_%EC%98%A4%EB%A6%AC.png 360w,\n/static/ee6c3bd067184c1c22a417c8eecc00de/37523/%EB%B9%84%ED%8A%B8%EA%B2%90%EC%8A%88%ED%83%80%EC%9D%B8_%EC%98%A4%EB%A6%AC.png 720w,\n/static/ee6c3bd067184c1c22a417c8eecc00de/302a4/%EB%B9%84%ED%8A%B8%EA%B2%90%EC%8A%88%ED%83%80%EC%9D%B8_%EC%98%A4%EB%A6%AC.png 1080w,\n/static/ee6c3bd067184c1c22a417c8eecc00de/b490f/%EB%B9%84%ED%8A%B8%EA%B2%90%EC%8A%88%ED%83%80%EC%9D%B8_%EC%98%A4%EB%A6%AC.png 1142w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br>\n<h2 id=\"내가-개발을-사랑하는-이유\" style=\"position:relative;\"><a href=\"#%EB%82%B4%EA%B0%80-%EA%B0%9C%EB%B0%9C%EC%9D%84-%EC%82%AC%EB%9E%91%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0\" aria-label=\"내가 개발을 사랑하는 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>내가 개발을 사랑하는 이유</h2>\n<p>왜 개발자가 되려고 하세요? 라는 질문에 대답을 한참 망설였던 적이 있다. 이전에는 과정-결과가 명확해 이걸 맞추면 성취감이 들어서라고 대답했다. 위 챕터를 읽은 지금은 “내가 한 주관적 선택들이 코드에 쌓여 있어 내가 아름답다고 느끼거나, 소중하다고 생각되기 때문에” 라고 대답하고 싶다.</p>","frontmatter":{"date":"December 13, 2022","title":"왜 나는 너를 사랑하는가 chapter -9","categories":"독서","author":"수달","emoji":"🙂"},"fields":{"slug":"/etc/why_love/"}},"site":{"siteMetadata":{"siteUrl":"https://her0807.com","comments":{"utterances":{"repo":"https://github.com/her0807/her0807.github.io"}}}}},"pageContext":{"slug":"/spring/test_construcor/","nextSlug":"/undo/","prevSlug":"/etc/why_love/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}