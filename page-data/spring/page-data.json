{"componentChunkName":"component---src-templates-blog-template-js","path":"/spring/","result":{"data":{"cur":{"id":"0d138b16-66d2-568b-abc7-637b55c60ed0","html":"<h2 id=\"학습-동기\" style=\"position:relative;\"><a href=\"#%ED%95%99%EC%8A%B5-%EB%8F%99%EA%B8%B0\" aria-label=\"학습 동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>학습 동기</h2>\n<p>스프링을 사용하면서 습관처럼 의존성 주입을 생성자 주입으로 받곤 했어요. 처음 접한 방식은 @Autowired 였는데 매 필드마다 달아주는게 너무 힘들었거든요. 생성자는 IDE 에서 자동 생성이 되니까 편리하게 사용이 가능하고, 필드에 final 을 붙일 수 있어 불변을 보장해줘서 더 안정적이게 느껴졌어요.</p>\n<p>그러다 문득 의존성을 주입하는 방식이 3가지나 있는데, 지금 방법보다 더 나은 방법은 없을까? 궁금해졌어요. 그래서 장단점을 파악해보기로 했습니다.</p>\n<blockquote>\n<p>의존성 주입이란 무엇일까요? ☺️\n의존성 주입이란 스프링에서 제공하는 DI 기능입니다. 스프링에서는 객체를 싱글톤 빈으로 관리하고, 필요한 곳에 적절히 주입시켜주어 객체를 계속 생성해 부하가 발생하는 문제를 해결했어요!  그래서 대용량 트래픽 처리에 스프링을 사용하면 좋을 것 같다는 생각을 했습니다.</p>\n</blockquote>\n<h2 id=\"생성자-주입constructor-injection\" style=\"position:relative;\"><a href=\"#%EC%83%9D%EC%84%B1%EC%9E%90-%EC%A3%BC%EC%9E%85constructor-injection\" aria-label=\"생성자 주입constructor injection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>생성자 주입(Constructor Injection)</strong></h2>\n<ul>\n<li>생성시 값이 주입되기 때문에 final 키워드를 붙여 불변을 보장할 수 있어요.</li>\n<li>객체를 생성자를 통해 직접 주입 시킬 수 있어 테스트 코드를 작성하기 수월해요.</li>\n<li>lombok 을 사용할 수 있어요!</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HomeController</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">GameService</span> gameService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/*\n\t\t* 스프링 초기에는 Autowired 를 사용한 의존성 주입 방식을 사용했기 때문에\n\t\t* Spring 4.3 이전 버전이면 @Autowired 필요해요. \n\t\t*/</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">HomeController</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GameService</span> gameService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gameService <span class=\"token operator\">=</span> gameService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"autowired-로-의존성-주입받기-field-injection\" style=\"position:relative;\"><a href=\"#autowired-%EB%A1%9C-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A3%BC%EC%9E%85%EB%B0%9B%EA%B8%B0-field-injection\" aria-label=\"autowired 로 의존성 주입받기 field injection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Autowired 로 의존성 주입받기 (<strong>Field Injection)</strong></h2>\n<ul>\n<li>객체 생성 이후 값이 주입되니까 <strong>final 키워드를 붙일 수 없어요.</strong></li>\n<li>필드에 @Autowired를 붙여서 사용해요.</li>\n</ul>\n<p>영어로는 자동 연결 정도로 해석이 되는데요. <a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html\">공식 문서</a>를 본다면 해당 필드에 빈 주입이 필요하다는 것을 선언함으로 runtime 중 호출 시점에 의존성이 주입된다고 하네요.  생성자 없이도 필드를 추가하고 어노테이션만 붙여주면 되어서 편리하겠네요.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAARElEQVQI14WMOwrAMAxDc/9L+gT+rjZWcaGhUzIIpIekRUSICHQ3MhNVddSts+bMzODuUNXXDxs/bLKI7PznzLy3H3sARH6atynkJ+kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"reference.png\"\n        title=\"reference.png\"\n        src=\"/static/6125c12938628fe087563257aace448b/37523/reference.png\"\n        srcset=\"/static/6125c12938628fe087563257aace448b/e9ff0/reference.png 180w,\n/static/6125c12938628fe087563257aace448b/f21e7/reference.png 360w,\n/static/6125c12938628fe087563257aace448b/37523/reference.png 720w,\n/static/6125c12938628fe087563257aace448b/302a4/reference.png 1080w,\n/static/6125c12938628fe087563257aace448b/07a9c/reference.png 1440w,\n/static/6125c12938628fe087563257aace448b/fa60d/reference.png 1792w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 id=\"수정자-주입-방식-setter-based-injection\" style=\"position:relative;\"><a href=\"#%EC%88%98%EC%A0%95%EC%9E%90-%EC%A3%BC%EC%9E%85-%EB%B0%A9%EC%8B%9D-setter-based-injection\" aria-label=\"수정자 주입 방식 setter based injection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>수정자 주입 방식 (<strong>Setter based Injection)</strong></h2>\n<ul>\n<li>객체 생성 이후 값이 주입되니까 <strong>final 키워드를 붙일 수 없어요.</strong></li>\n<li>setter 메서드에 @Autowired를 붙여서 사용해요.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberService</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">PointService</span> pointService<span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token annotation punctuation\">@Autowired</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setPointService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PointService</span> pointService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t    \t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pointService <span class=\"token operator\">=</span> pointService<span class=\"token punctuation\">;</span>\n\t   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"문제점---순환참조-발생시-파악하기-어려움\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C%EC%A0%90---%EC%88%9C%ED%99%98%EC%B0%B8%EC%A1%B0-%EB%B0%9C%EC%83%9D%EC%8B%9C-%ED%8C%8C%EC%95%85%ED%95%98%EA%B8%B0-%EC%96%B4%EB%A0%A4%EC%9B%80\" aria-label=\"문제점   순환참조 발생시 파악하기 어려움 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제점 - 순환참조 발생시 파악하기 어려움</h2>\n<p><strong>필드나 수정자로 의존성을 주입받게 되면</strong> 우선 빈이 생성된 후, 호출되는 시점에 의존성이 필요한 객체를 주입하기 때문에 어플리케이션이 실행되고 있을 때는 순환참조 문제가 발생하지 않아요. 실제로 호출되면 서로를 계속 호출하게 될 테니까 무한 반복이 되다가 서버가 다운되겠죠? 😢</p>\n<p><strong>반면, <code class=\"language-text\">생성자를 통해 주입</code>하고 실행해보면 BeanCurrentlyInCreationException이 발생하게 돼요. 순환 참조 뿐만 아니라 잘못된 의존관계도 실행 시점에 파악할 수 있어서 좋아요.</strong></p>\n<p>순환 참조가 발생했다는 것은 객체간 결합도가 높아 유지보수하기 어려운 코드임을 알리는 신호에요. 이때는 설계가 잘못되진 않았는지 확인할 필요가 있어요.</p>\n<blockquote>\n<p>순환 참조 문제가 있는 코드</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberService</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token annotation punctuation\">@Autowired</span>\n   <span class=\"token keyword\">private</span> <span class=\"token class-name\">PointService</span> pointService<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sayMemberHi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        pointService<span class=\"token punctuation\">.</span>sayPointHi<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PointService</span> <span class=\"token punctuation\">{</span>\n\n   <span class=\"token annotation punctuation\">@Autowired</span>\n   <span class=\"token keyword\">private</span> <span class=\"token class-name\">MemberService</span> memberService<span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sayPointHi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        pointService<span class=\"token punctuation\">.</span><span class=\"token function\">sayMemberHi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"어떤-방법이-제일-좋을까-\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%96%A4-%EB%B0%A9%EB%B2%95%EC%9D%B4-%EC%A0%9C%EC%9D%BC-%EC%A2%8B%EC%9D%84%EA%B9%8C-\" aria-label=\"어떤 방법이 제일 좋을까  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어떤 방법이 제일 좋을까? 😀</h2>\n<p>장단점을 찾아보며 생성자로 의존성을 주입하는 방식이 가장 좋다고 느꼈어요. 이유는 아래와 같아요.</p>\n<h3 id=\"1-불변-객체를-보장할-수-있어요\" style=\"position:relative;\"><a href=\"#1-%EB%B6%88%EB%B3%80-%EA%B0%9D%EC%B2%B4%EB%A5%BC-%EB%B3%B4%EC%9E%A5%ED%95%A0-%EC%88%98-%EC%9E%88%EC%96%B4%EC%9A%94\" aria-label=\"1 불변 객체를 보장할 수 있어요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 불변 객체를 보장할 수 있어요.</h3>\n<p>객체 생성시 필드 값을 초기화 하면 final 키워드를 사용해서 객체 값이 변하지 않도록 할 수 있어요. 믿고 객체를 사용할 수 있게 되어서 좋아요.</p>\n<h3 id=\"2-테스트-코드를-작성하기-용이하고-스프링을-걷어내도-변경이-적어져요\" style=\"position:relative;\"><a href=\"#2-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0-%EC%9A%A9%EC%9D%B4%ED%95%98%EA%B3%A0-%EC%8A%A4%ED%94%84%EB%A7%81%EC%9D%84-%EA%B1%B7%EC%96%B4%EB%82%B4%EB%8F%84-%EB%B3%80%EA%B2%BD%EC%9D%B4-%EC%A0%81%EC%96%B4%EC%A0%B8%EC%9A%94\" aria-label=\"2 테스트 코드를 작성하기 용이하고 스프링을 걷어내도 변경이 적어져요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 테스트 코드를 작성하기 용이하고, 스프링을 걷어내도 변경이 적어져요.</h3>\n<p>생성자로 의존성을 주입 받게 되면 <code class=\"language-text\">new PointService(넣고 싶은 객체 선언)</code>  와 같이  객체를 직접 넣을 수 있게 되어요. 그래서 단위 테스트나 슬라이스 테스트를 할 때 한결 수월해져요.</p>\n<p>또한 스프링을 걷어낸다면 의존성을 주입해주는 DI 가 없어져요! 그러면 해당 코드는 거의 모든 로직에서 변경이 일어나겠죠 .. ? 생성자가 있다면 문제 없어요! 물론 최소 한번은 어디선가 주입해줘야하지만 실제 객체 내부에는 큰 변화가 없을거예요 😝</p>\n<h3 id=\"3-ide-단축키와-lombok-을-사용해서-편리하게-생성자를-만들-수-있어요\" style=\"position:relative;\"><a href=\"#3-ide-%EB%8B%A8%EC%B6%95%ED%82%A4%EC%99%80-lombok-%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%84%9C-%ED%8E%B8%EB%A6%AC%ED%95%98%EA%B2%8C-%EC%83%9D%EC%84%B1%EC%9E%90%EB%A5%BC-%EB%A7%8C%EB%93%A4-%EC%88%98-%EC%9E%88%EC%96%B4%EC%9A%94\" aria-label=\"3 ide 단축키와 lombok 을 사용해서 편리하게 생성자를 만들 수 있어요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. IDE 단축키와 lombok 을 사용해서 편리하게 생성자를 만들 수 있어요!</h3>\n<blockquote>\n<p><strong>lombok 이란? Java의 라이브러리로 반복되는 메소드를 Annotation 을 사용해서 자동생성 해주는 라이브러리</strong></p>\n</blockquote>\n<p>IDE 단축키 를 사용하면 (command + n → constructor ) 쉽게 생성자를 만들 수 있고, lombok 에 있는 <strong><strong>@RequiredArgsConstructor 을 사용하면 어노테이션 하나만 붙이면 생성자가 자동으로 만들어져요!</strong></strong></p>\n<p><strong>정리!  생성자 주입 방법을 사용하면 프레임워크에 의존하지 않고, 순수 자바 언어의 특징을 제일 잘 살릴 수 있게 돼요.</strong></p>\n<h2 id=\"di-시-조회되는-빈이-두-개-이상일-경우는-어떤-빈이-주입될까\" style=\"position:relative;\"><a href=\"#di-%EC%8B%9C-%EC%A1%B0%ED%9A%8C%EB%90%98%EB%8A%94-%EB%B9%88%EC%9D%B4-%EB%91%90-%EA%B0%9C-%EC%9D%B4%EC%83%81%EC%9D%BC-%EA%B2%BD%EC%9A%B0%EB%8A%94-%EC%96%B4%EB%96%A4-%EB%B9%88%EC%9D%B4-%EC%A3%BC%EC%9E%85%EB%90%A0%EA%B9%8C\" aria-label=\"di 시 조회되는 빈이 두 개 이상일 경우는 어떤 빈이 주입될까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DI 시 <strong>조회되는 빈이 두 개 이상일 경우는 어떤 빈이 주입될까?</strong></h2>\n<p>아무런 작업 없이 위에 세가지 방법만 사용할 때 , 같은 인터페이스를 상속받은 구현체가 두개일 경우 <strong>NoUniqureBeanDefinitionException</strong> 예외가 발생해요.  해결 방법은 두가지 정도 소개할게요!</p>\n<h3 id=\"autowired-필드명-매칭\" style=\"position:relative;\"><a href=\"#autowired-%ED%95%84%EB%93%9C%EB%AA%85-%EB%A7%A4%EC%B9%AD\" aria-label=\"autowired 필드명 매칭 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Autowired 필드명 매칭</h3>\n<p>스프링에서 의존성을 주입할 때 아래과 같은 순서로 주입이 돼요. 그래서 이름으로 주입되는 객체를 지정할 수 있어요.</p>\n<ol>\n<li>\n<p>상위 타입을 구현한 하위 타입을 전부 조회한다.</p>\n</li>\n<li>\n<p>여러개일 경우 클래스 필드명과 일치하는 객체를 주입한다.</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MemberService</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PointService</span> superMartPointService<span class=\"token punctuation\">;</span>\n\t\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">MemberService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">PointService</span> pointService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>superMartPointService <span class=\"token operator\">=</span> pointService<span class=\"token punctuation\">;</span>\n\t <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"primary-어노테이션-사용\" style=\"position:relative;\"><a href=\"#primary-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98-%EC%82%AC%EC%9A%A9\" aria-label=\"primary 어노테이션 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Primary 어노테이션 사용</h3>\n<p>구현체가 여러개 조회되면 Primary 어노테이션이 붙은걸 우선순위로 넣어달라고 지정할 수 있어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Repository</span>\n<span class=\"token annotation punctuation\">@Primary</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">JpaRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ExampleRepository</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"의존성-주입-방법을-동시에-여러개-사용한다면-어떤-방법이-사용될까\" style=\"position:relative;\"><a href=\"#%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%A3%BC%EC%9E%85-%EB%B0%A9%EB%B2%95%EC%9D%84-%EB%8F%99%EC%8B%9C%EC%97%90-%EC%97%AC%EB%9F%AC%EA%B0%9C-%EC%82%AC%EC%9A%A9%ED%95%9C%EB%8B%A4%EB%A9%B4-%EC%96%B4%EB%96%A4-%EB%B0%A9%EB%B2%95%EC%9D%B4-%EC%82%AC%EC%9A%A9%EB%90%A0%EA%B9%8C\" aria-label=\"의존성 주입 방법을 동시에 여러개 사용한다면 어떤 방법이 사용될까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><strong>의존성 주입 방법을 동시에 여러개 사용한다면 어떤 방법이 사용될까?</strong></h2>\n<p>이런 일은 거의 없겠지만, 그냥 단순한 호기심에 의존성 주입 방법도 여러개를 쓸 수 있는데, 여러개가 사용된다면 어떤 방식이 채택될까 궁금해졌어요.  관련 글이 <a href=\"https://stackoverflow.com/questions/63826101/spring-dependency-injection-which-takes-precedence\">스택오버 플로우</a>에 있어서 확인해보니 객체가 생성되려면 생성자를 호출해야하기 때문에 <code class=\"language-text\">가장 먼저 생성자 주입</code>이 실행되고,  <code class=\"language-text\">그 다음으로는 필드</code>에 접근을 해야만 메서드 호출이 가능해지니 필드 주입, <code class=\"language-text\">마지막으로 메서드 주입</code>이 된다는 것을 발견했어요.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FootballCoach</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Coach</span> <span class=\"token punctuation\">{</span>\n    \n    <span class=\"token comment\">//Field Injection</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">FortuneService</span> fortuneService<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">//setter Injection</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setFortuneService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FortuneService</span> fortuneService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fortuneService <span class=\"token operator\">=</span> fortuneService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//constructor Injection</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FootballCoach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FortuneService</span> fortuneService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fortuneService <span class=\"token operator\">=</span> fortuneService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"느낀점\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\"느낀점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느낀점</h2>\n<ul>\n<li>의존성 주입은 생성자 주입 방식을 사용하는게 가장 좋다.</li>\n<li>구현체가 두개일 경우 필드명이나 우선순위를 통해 구현체 선택이 가능하다</li>\n<li>생성자 방식을 여러개 사용할 경우 <code class=\"language-text\">생성자 - 필드 - 메서드</code> 순으로 실행된다.</li>\n</ul>\n<p>습관처럼 사용하던 생성자로 의존성 주입하는 방식보다 더 좋은 방식은 없을까? 궁금하지 않았다면 위에 학습했던 재밌는 내용을 놓쳤을 것 같아요. 모든 학습은 의식적으로 내가 선택한 방식에 근거를 찾아가며 하는게 좋겠다고 생각되네요!</p>\n<h2 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h2>\n<ul>\n<li><a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html\">공식 문서</a></li>\n</ul>","excerpt":"학습 동기 스프링을 사용하면서 습관처럼 의존성 주입을 생성자 주입으로 받곤 했어요. 처음 접한 방식은 @Autowired 였는데 매 필드마다 달아주는게 너무 힘들었거든요. 생성자는 IDE 에서 자동 생성이 되니까 편리하게 사용이 가능하고, 필드에 final 을 붙일 수 있어 불변을 보장해줘서 더 안정적이게 느껴졌어요. 그러다 문득 의존성을 주입하는 방식이 3가지나 있는데, 지금 방법보다 더 나은 방법은 없을까? 궁금해졌어요. 그래서 장단점을 파악해보기로 했습니다. 의존성 주입이란 무엇일까요? ☺️\n의존성 주입이란 스프링에서 제공하는 DI 기능입니다. 스프링에서는 객체를 싱글톤 빈으로 관리하고, 필요한 곳에 적절히 주입시켜주어 객체를 계속 생성해 부하가 발생하는 문제를 해결했어요!  그래서 대용량 트래픽 처리에 스프링을 사용하면 좋을 것 같다는 생각을 했습니다. 생성자 주입(Constructor Injection) 생성시 값이 주입되기 때문에 final 키워드를 붙여 불변을 보장할 수…","frontmatter":{"date":"December 22, 2022","title":"Spring 을 사용하여 의존성을 주입할 시 생성자를 사용해야하는 이유","categories":"spring","author":"수달","emoji":"🙂"},"fields":{"slug":"/spring/"}},"next":{"id":"62cd453a-3ed8-599d-9371-3607bdaa920d","html":"<blockquote>\n<h2 id=\"msamicro-service-architecture란-\" style=\"position:relative;\"><a href=\"#msamicro-service-architecture%EB%9E%80-\" aria-label=\"msamicro service architecture란  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MSA(Micro Service Architecture)란 ?</h2>\n</blockquote>\n<p><code class=\"language-text\">시스템을 여러개의 독립된 서비스(기능)로 나눠서, 이 서비스를 조합함으로서 기능을 제공하는 아키텍처</code> 디자인 패턴입니다. 완전히 독립적으로 배포가 가능하기 때문에 다른 기술 스택을 사용할 수 있어요.</p>\n<h3 id=\"모놀리식-구조monolithic-architecure\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%86%80%EB%A6%AC%EC%8B%9D-%EA%B5%AC%EC%A1%B0monolithic-architecure\" aria-label=\"모놀리식 구조monolithic architecure permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모놀리식 구조(Monolithic Architecure)</h3>\n<p><code class=\"language-text\">하나의 프로그램안에 모든 기능이 있는 통합되어 있는 형태</code>를 말합니다. 관리가 쉬우며 초기 배포 단계에 설정할 것이 많지 않아서 MSA 보다 비교적 간단하게 서버 운영이 가능합니다. :)</p>\n<h3 id=\"모놀리식-구조-문제점\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%86%80%EB%A6%AC%EC%8B%9D-%EA%B5%AC%EC%A1%B0-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"모놀리식 구조 문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모놀리식 구조 문제점</h3>\n<ul>\n<li>\n<p><strong>부분 장애가 전체 서비스 장애로 이어진다.</strong></p>\n<p>모놀리식 구조를 가진 프로젝트를 했을 당시,  회원 가입 로직에서 문제가 생겨 서버가 다운된 적이 있습니다.  <code class=\"language-text\">개발자의 잘못된 코드</code> 혹은 갑자기 트래픽 증가로 인해서 성능에 문제가 생겼을 때, 서비스 전체의 장애로 확대될 수 있어요.</p>\n</li>\n<li>\n<p><strong>부분적인 scale-out 이 어렵다.</strong></p>\n<p>회원 가입은 부하가 자주 일어나지 않지만, 상품 주문은 빈번히 일어나는 작업이죠! 이럴 경우 더 많은 트래픽을 감당할 수 있는 인프라 구조가 필요한데요. 모놀리식 구조의 경우 서버를 나누어 처리할 수 없기 때문에 <code class=\"language-text\">부분적인 스케일 관리가 어렵습니다.</code></p>\n</li>\n<li>\n<p><strong>서비스의 변경이 어렵고, 수정시 장애의 영향 파악이 어렵다.</strong></p>\n<p>여러 기능이 하나의 프로젝트 내부에 있다보면 의존성이 강하게 엮어있어서 장애 포인트를 찾기 어려웠던 경험이 있어요. 그래서 이런 부분을 <a href=\"https://www.youtube.com/watch?v=dJ5C4qRqAgA&#x26;t=1617s\">조영호님의 우아한 객체지향 영상</a>을 보며 조금이나마 해소하고자 했었는데요. 이런 문제가 발생하는 이유는 하나의 프로젝트에 여러 기능들이 있기 때문이기에 MSA 로 전환한다면 해당 문제를 조금이나마 해소할 수 있을 거에요.</p>\n</li>\n<li>\n<p><strong>배포 시간이 오래걸린다.</strong></p>\n<p>작은 기능임에도 불구하고 프로젝트 규모가 커 테스트 실행시간, 배포 시간이 많이 드는 경험을 한 적이 있어요. 기능별로 분리하면 테스트 코드 개수도 감소하고, 배포 파일 크기도 감소하기 때문에 <code class=\"language-text\">CI/CD 속도도 훨씬 빨라질거예요!</code></p>\n</li>\n</ul>\n<h3 id=\"msa-등장-배경\" style=\"position:relative;\"><a href=\"#msa-%EB%93%B1%EC%9E%A5-%EB%B0%B0%EA%B2%BD\" aria-label=\"msa 등장 배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MSA 등장 배경</h3>\n<p>이러한 <code class=\"language-text\">모놀리식 구조의 문제점들을 보완하기 위해 MSA가 등장</code>하게 되었답니다. 기존에 특정 물리 서버에 서비스를 올리던 on-promise 서버 기반의 모놀리식에서 이제는 클라우드 환경을 이용하여 서버를 구성하는 MSA 로 많은 서비스들이 전환되고 있어요.</p>\n<blockquote>\n<h2 id=\"msa-특징\" style=\"position:relative;\"><a href=\"#msa-%ED%8A%B9%EC%A7%95\" aria-label=\"msa 특징 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MSA 특징</h2>\n</blockquote>\n<p><code class=\"language-text\">API 를 통해서만 상호작용</code>을 할 수 있어요.  서비스 끼리 end-point 를 API 형태로 외부에 노출하고, 실질적인 세부 사항은 모두 추상화 합니다.</p>\n<ul>\n<li><code class=\"language-text\">하나의 기능만 수행</code>합니다. 여러 어플리케이션에서 서비스를 호출하여 상호작용할 수 있습니다.</li>\n<li>프로토콜을 사용해 통신하므로 서비스 <code class=\"language-text\">구현 기술을 다양하게 사용</code>할 수 있습니다.</li>\n<li>집중화된 관리 체계를 사용하지 않아요. ESB(Enterprise Sevice Bus)와 같은 무거운 제품에 의존하지 않고, <code class=\"language-text\">REST 등 가벼운 통신 아키텍처, 또는 카프카 등을 이용한 메세지 스트림을 주로 사용</code>합니다.</li>\n<li><code class=\"language-text\">독립적인 배포</code>가 가능해요!</li>\n<li><code class=\"language-text\">개별적인 scale-out 이 가능</code>해요. 메모리, CPU적으로도 상당부분 이득이 됩니다.</li>\n</ul>\n<blockquote>\n<h2 id=\"mas-단점\" style=\"position:relative;\"><a href=\"#mas-%EB%8B%A8%EC%A0%90\" aria-label=\"mas 단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MAS 단점</h2>\n</blockquote>\n<ul>\n<li>\n<p><code class=\"language-text\">많이 복잡해요.</code> 서비스가 분산되어 있기 때문에 내부 서비스 통신을 어떻게 가져가야할지 정해야하고, 또 통신 장에나 서버 부하가 있을 경우 트랜잭션 관리에 대해서도 고민할 점이 많아요.</p>\n<p>모놀리식에서는 단일 트랜잭션을 유지하면 됐지만, <code class=\"language-text\">MSA</code> 에서는 비지니스에 대한 DB 를 가지고 있는 서비스도 각기 다르고 서비스 연결을 위해서는 통신이 포함되기 때문에 <code class=\"language-text\">트랜잭션을 유지하는게 어렵습니다.</code></p>\n</li>\n<li>\n<p>통합테스트가 어렵다. 개발 환경과 실제 운영환경을 동일하게 가져가는 것이 쉽지 않아요.</p>\n</li>\n<li>\n<p><code class=\"language-text\">단일 서비스를 배포하더라도, 다른 서비스들과 연계가 정상적으로 이뤄지고 있는지도 확인</code>해야합니다.</p>\n</li>\n</ul>\n<h2 id=\"모놀리식-vs-msa\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%86%80%EB%A6%AC%EC%8B%9D-vs-msa\" aria-label=\"모놀리식 vs msa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모놀리식 vs MSA</h2>\n<p>다양한 기술 스택을 사용하고, 메모리 관리가 용이하고,  단일 장애가 전체 시스템에 영향을 주면 안되는 상황들은 보통 대규모 서비스를 운영할 때 필요할 것 같아요.\n보통 서비스 유저가 1000명 정도 되는 서비스에서는 MSA 의 장점을 취하지 충분히 운영이 가능했었거든요. 서비스가 점점 커지면 각 도메인간 의존성이 늘어나고, PR 단위에서 많은 충돌이 발생하고, 배포하는데도 오래걸렸던 경험이 있어요. 이런 문제들을 해소하기 위한 방법 중 하나인 MSA 를 학습하며 사용자가 많은 서비스를 운영해보면서 더 많은 고민들을 하면 재밌겠다고 생각하게 된 계기가 되었습니다.</p>\n<blockquote>\n<h2 id=\"msa-에서-궁금한-점들\" style=\"position:relative;\"><a href=\"#msa-%EC%97%90%EC%84%9C-%EA%B6%81%EA%B8%88%ED%95%9C-%EC%A0%90%EB%93%A4\" aria-label=\"msa 에서 궁금한 점들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MSA 에서 궁금한 점들</h2>\n</blockquote>\n<h3 id=\"어떻게-트랜잭션-관리를-할까\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EB%A6%AC%EB%A5%BC-%ED%95%A0%EA%B9%8C\" aria-label=\"어떻게 트랜잭션 관리를 할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어떻게 트랜잭션 관리를 할까?</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    배달 시스템에서 주문을 한다고 가정하면 \n    - `결제를 시작하고`\n    - `쿠폰을 적용하고`\n    - `카드를 선택하고`\n    - `메뉴 주문이 가능한지 한번더 확인`\n    - `결제 완료`\n    - 배달 요청이 전송된다.</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">이 여러개의 작업 단위를 하나의 트랜잭션으로 묶어서 하나라도 제대로 된 처리가 되지 않으면 롤백하고 예외 처리를 해줘야하는데 이런 부분을 어떻게 하고 있을까?\n\n그동안 서비스 레이어를 작성하면서 API 요청은 하나만 들어오고 여러개의 행위를 수행했는데 이렇게 되면 </code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    \n    1)  결제를 시작한다. (api call)\n    \n    2) 쿠폰 사용가능한지 확인한다. \n    \n    2-1) 쿠폰 사용이 가능하면 사용 처리한다.\n    \n    3) 쿠폰 적용한 금액을 반환한다.\n    \n    4) 카드를 선택한다.\n    \n    5) 결제팀에서 결제 요청을 전송한다.\n    \n    A- 1) `결제가 취소`되었다.\n    \n    A-2) 결제가 실패되면 `쿠폰사용도 취소`한다 . \n    \n    ---\n    \n    B-1) `결제가 성공`했다.\n    \n    B-2) `결제 내역을 히스토리에 저장`한다.\n</code></pre></div>\n<p>이런 느낌으로 트랜잭션이 묶여야 할 것 같은데 이런걸 이벤트 처리로 하는건지\n아직 이벤트에 대한 학습이 부족해서 잘 모르겠네요 ㅠㅠ\n이 부분은 추가학습 한 뒤 내용을 덧붙여보겠습니다.</p>\n<blockquote>\n<h2 id=\"모놀리식-vs-msa-1\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%86%80%EB%A6%AC%EC%8B%9D-vs-msa-1\" aria-label=\"모놀리식 vs msa 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모놀리식 vs MSA</h2>\n</blockquote>\n<p>시스템의 규모가 작음에도 MSA 구조를 사용하는 것은 모든 요청마다 네트워크 비용이 추가되고, 서버 운영 비용도 추가되고,  테스트를 하기 어려워지고, 트랜잭션관리도 하기 힘들어지는 문제를 야기할 수 있어요. 그래서 대부분의 개발초기에서는 모놀리식 구조를 가지고 있다가 서비스가 커지면 MSA 전환을 고려하는 것 같아요 ㅎㅎ 각 구조의 트레이드 오프를 이해하고 사용해야겠습니다.</p>\n<blockquote>\n<h2 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h2>\n</blockquote>\n<ul>\n<li><a href=\"https://kkh1902.tistory.com/181\">MSA 란 무엇인가</a></li>\n</ul>","frontmatter":{"date":"December 21, 2022","title":"MSA(MicroService Architecture) 란 무엇인가","categories":"architecture","author":"수달","emoji":"🙂"},"fields":{"slug":"/design_pattern/"}},"prev":{"id":"0363b90b-b68e-5dda-afc2-163c61787cf4","html":"<h2 id=\"학습-동기\" style=\"position:relative;\"><a href=\"#%ED%95%99%EC%8A%B5-%EB%8F%99%EA%B8%B0\" aria-label=\"학습 동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>학습 동기</h2>\n<p>프로젝트를 진행하며 사용자에게 로그인을 유지시켜 주기 위해서 JWT 를 사용한 적이 있어요. 그 때 인증과 인가의 개념을 헷갈렸던 기억이 있어서 다시한번 복기 할 겸 정리해보기로 했습니다.</p>\n<h2 id=\"인증\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D\" aria-label=\"인증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증</h2>\n<p>인증 단계에서는 사용자의 신원을 확인하는 단계입니다. 처음 회사에 들어가면 회사 사람인지 확인하고 출입증을 주는 행위를 신원확인 단계라고 할 수 있을 것 같아요. 핸드폰 FaceID 로도 핸드폰의 주인이 맞는지 인증하는 것도 예시로 들 수 있을 것 같아요.  ㅎㅎ</p>\n<p>서버에서 인증 처리는 다양하게 <code class=\"language-text\">쿠키, 세션, 토큰</code> 등등 으로 할 수 있는데요. 위 세가지의 특성에 대해서 알아보겠습니다.</p>\n<h3 id=\"쿠키-세션-토큰의-등장-배경\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%ED%86%A0%ED%81%B0%EC%9D%98-%EB%93%B1%EC%9E%A5-%EB%B0%B0%EA%B2%BD\" aria-label=\"쿠키 세션 토큰의 등장 배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠키, 세션, 토큰의 등장 배경!</h3>\n<p>통신을 할 때 과거 히스토리까지 전부 담에서 네트워크를 넘나들면 요청 자체가 너무 무거워지고, 해당 기록이 유실될 경우 원활한 통신이 어렵기 때문에 <code class=\"language-text\">HTTP 통신은 무상태성(statusless)이라는 특징을 가지고 있어요.</code>  비연결성도 하나의 특징이랍니다. 이렇게 된다면 모든 요청 때 마다 ID ,PW 를 입력하여 사용자 인증을 해야하는 불편함이 생길거예요. 그래서 이런 부분들을 해소하기 위해서 쿠키, 세션, 토큰이 등장하기 시작했어요.</p>\n<h3 id=\"쿠키\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%ED%82%A4\" aria-label=\"쿠키 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠키</h3>\n<p>쿠키는 <code class=\"language-text\">사용자 정보를 사용자의 브라우저에 저장</code>시키는데요. 서버는 클라이언트의 로그인 요청에 대한 응답을 작성할 때 클라이언트 측에 <code class=\"language-text\">저장하고 싶은 정보를 set-cookie 에 담아</code> 놓습니다. 간편한 쿠키 발행과 연결 유지라는 장점이 있으나, 쿠키가 탈취되면 사용자의 정보도 탈취되고, 사용자인 척 서비스에 접근해 특정 작업을 수행할 수 있으니 보안에 취약하다는 단점이 있습니다.</p>\n<h3 id=\"세션\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98\" aria-label=\"세션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션</h3>\n<p>위에 사용자 정보 탈취라는 문제를 해결하기 위해서 세션은 비밀번호와 같은 인증번호를 쿠키에 저장하지 않고 <code class=\"language-text\">사용자 식별자인 세션 ID를 저장합니다</code>. 최초 로그인 시 서버에서 세션을 발급하여 세션 스토리지에 저장해두고, 요청이 들어왔을 때 올바른 세션 ID 인지 확인 후 로그인을 시켜주는 방식입니다. 세션은 서버에 저장되기 때문에 사용자가 수만명으로 늘어난다면 <code class=\"language-text\">서버에 부하</code>가 갈 수 있고 분산 DB 환경에서 세션 유실이 일어날 수도 있습니다.</p>\n<h3 id=\"토큰\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0\" aria-label=\"토큰 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰</h3>\n<p>토큰은 DB에 데이터를 저장하는 것이 아니라 토큰 자체에 사용자 고유 식별값을 넣어서 모든 요청시 토큰을 주고 받으면서 인증 처리를 합니다.</p>\n<p>토큰은 <code class=\"language-text\">머리(header)</code>, <code class=\"language-text\">가슴(payload)</code>, <code class=\"language-text\">배(signature)</code> 로 나눠지며 헤더에는 사용자 고유정보를 암호화할 알고리즘이 무엇인지 담고 있어요. 페어로드에는 사용자 고유 값과, 주고 받고 싶은 내용, 만료 시간 등이 있고요. 시그니처는 사용자가 발급한 주체를 명시하는 내용이에요.</p>\n<p>정리하면 페이로그에 있는 내용을 시그니처와 섞어서 헤더에 있는 암호 알고리즘으로 암호화 한 내용을 담은것이 토큰이라고 합니다.</p>\n<h3 id=\"토큰-장점\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0-%EC%9E%A5%EC%A0%90\" aria-label=\"토큰 장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰 장점</h3>\n<ul>\n<li>시그니처를 알 수 없다면 위변조를 막을 수 없어요.</li>\n<li>인증 정보에 대한 별도의 관리가 필요 없어요.</li>\n<li>토큰이 한번 발급되면 만료될 때까지 사용할 수 있어요.</li>\n</ul>\n<h3 id=\"토큰의-단점\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0%EC%9D%98-%EB%8B%A8%EC%A0%90\" aria-label=\"토큰의 단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰의 단점</h3>\n<ul>\n<li>쿠키, 세션과 마찬가지로 탈취되면 위험해요.</li>\n<li>강제로 토큰을 만료시켜버릴 수 없기 때문에 만료 시간을 짧게 가져야해요.</li>\n<li>페이로드에는 중요한 정보를 담으면 안된다.</li>\n</ul>\n<h3 id=\"해결-방법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95\" aria-label=\"해결 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 방법</h3>\n<ul>\n<li>\n<p>리프레쉬 토큰</p>\n<p>토큰과 리프레쉬 토큰을 함께 발급하고, 리프레쉬 토큰은 서버에 저장해두었다가 토큰이 만료되면 리프레쉬 토큰을 확인하여 토큰을 새로 발급해준다.</p>\n</li>\n<li>\n<p>Sliding Session</p>\n<p>지속적으로 사용하고 있는 사용자에게 만료기간을 늘려준다.</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"인가\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EA%B0%80\" aria-label=\"인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인가</h2>\n<p>사용자를 식별했다면, 사용자의 권한에 따른 접근 허가도 필수인데요.  예를 들면 관리자 권한이 있는 사람만 일반 사용자의 데이터를 전체 다 볼 수 있게한다던가. 로그인을 한 사용자가 사장님인지, 손님인지에 따라서 사장님 페이지에 접근을 할 수 있는 권한을 주는 등 <code class=\"language-text\">권한을 부여하는 것을 인가</code>라고 합니다.</p>\n<h3 id=\"토큰을-사용한-인가-방식\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%9C-%EC%9D%B8%EA%B0%80-%EB%B0%A9%EC%8B%9D\" aria-label=\"토큰을 사용한 인가 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰을 사용한 인가 방식</h3>\n<p>토큰의 페이로드 부분에 사용자 식별자 외에도 다른 데이터를 넣을 수 있는데요! 이 점을 활용해서 사용자의 권한 정보를 함께 넣어두고 토큰이 유효한지 확인할 때, 페이로드를 디코딩하여 권한 검증까지 함께 할 수 있습니다.</p>\n<p>이전에 프로젝트 할 당시 페이로드에 사용자 권한 정보를 넣어두고 그 값을 <code class=\"language-text\">Spring RequestScope</code> 에 담아서 요청에 대한 권한 확인이 필요할 때마다 그 값이 권한이 있는지를 확인하는 작업들을 했었어요. 그 작업들은 Spring AOP 를 사용하여 <code class=\"language-text\">OnlyAdmin</code> 과 같이 어노테이션 기반으로 동작가능하게 했어요.</p>\n<h2 id=\"느낀점\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\"느낀점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느낀점</h2>\n<p>간단하게 인증은 사용자를 식별하는 것, 인가는 사용자의 권한을 부여하는 행위라고 이해하고 있었는데, 구체적인 장단점을 떠올려보니 다음 작업을 할 때에 더 이유있는 코드를 작성할 수 있을 것 같아요.</p>","frontmatter":{"date":"December 22, 2022","title":"인증과 인가","categories":"보안","author":"수달","emoji":"🙂"},"fields":{"slug":"/spring/authentication/"}},"site":{"siteMetadata":{"siteUrl":"https://her0807.com","comments":{"utterances":{"repo":"https://github.com/her0807/her0807.github.io"}}}}},"pageContext":{"slug":"/spring/","nextSlug":"/design_pattern/","prevSlug":"/spring/authentication/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}